<!doctype html>

<style>
    .panel {

        float:right;
    }
    canvas {
        border: 1px solid black;
    }

    div {
        background: lightgrey;
        padding: 0.1em;
        margin: 0.1em;
    }

    div[id$='View'] {
        max-height: 400px;
        overflow: auto;
    }

    .matrix {
        border: darkorange;
        background:whitesmoke;
        font-size: 0.8em;
    }

    .matrix tr {

        border: 0.3em solid darkgoldenrod;
    }
    .matrix td {
        border: 0.4em solid firebrick;
    }


    aside {
        float: right;
    }
</style>
<body onload="init()">
<div id="html">


    <div id="selectView">
        <button id="showCanvas">Canvas</button>
        <button id="showVertexShader">Vertex Shader</button>
        <button id="showFragmentShader">Fragment Shader</button>
        <button id="showJavaScript">JavaScript</button>
    </div>
    <aside>
        <div id="MVMatrix"></div>
        <div id="PMatrix"></div>
        <div id="NMatrix"></div>
        <div id="uCamera"></div>
    </aside>
    <div id="view">

        <div id="canvasView">
            <canvas id="canvas" width="800" height="400"></canvas>
            <div id="fpsCounter">
                fps: <span id="fps"></span>
            </div>
        </div>
        <div id="vertexShaderView" hidden>
        </div>
        <div id="fragmentShaderView" hidden>
        </div>
        <div id="javaScriptView" hidden>
        </div>
        <div>Status:
            <span id="statusMessages"></span>
        </div>
    </div>
</div>


</div>
<div id="controls">
    <label>Mesh
        <select id="meshSelection">
            <option value="Floor">Floor</options>
            <option value="Grid">Grid</option>
            <option value="Plane+Wall">Plane+Wall</option>
            <option value="Triangle">Triangle</option>
            <option value="Cube">Cube</option>
            <option value="Cone">Cone</option>
            <option value="Trapezoid">Trapezoid</option>
            <option value="Sphere">Sphere</option>
        </select>
        <label id="selectedMeshInfo"></label>
    </label>

    <label>Array/Fix Color:
        <input type="checkbox" id="useColors">
    </label>
    <label>Texture
        <input type="checkbox" id="useTexture">
    </label>
    <label>Repeat Drawing:
        <input type="checkbox" id="repeatDraw">
    </label>
    <label>uAlpha
        <input type="number" id="alphaChannel" min="0.0" step="0.1" max="1.0">
    </label>
    <label>
        enable Blending
        <input type="checkbox" id="setBlending">
    </label>
    <label>
        enable Depth Test
        <input type="checkbox" id="setDepthTest">
    </label>
    </div>
<div>
    <button id="drawButton">draw</button>
    <label>Drawing Mode
        <select id="drawingModes">
            <option value="TRIANGLES">TRIANGLES</option>
            <option value="TRIANGLE_STRIP">TRIANGLE_STRIP</option>
            <option value="TRIANGLE_FAN">TRIANGLE_FAN</option>
            <option value="POINTS">POINTS</option>
            <option value="LINES">LINES</option>
            <option value="LINE_LOOP">LINE_LOOP</option>
            <option value="LINE_STRIP">LINE_STRIP</option>
        </select>
        <label id="selectedDrawingMode"></label>
    </label>
    <label>gl_PointSize
        <input type="number" min="1.0" max="100.0" step="1.0" id="setPointSize">
    </label>
    <label>Import
        <input type="text" id="loadModelUrl">
        <button id="loadModelButton">load</button>
    </label>

    <div id="lightConfig" class="panel">
        <b>Lights</b><br>

        <div>
            <label>LightPosition
                <input type="text" id="lightPosition">
            </label>
            <label>LightDirection
                <input type="text" id="lightDirection">
            </label>
            <label>Shininess
                <input type="range" id="setShininess" min="0.0" max="1.0" step="0.01">
            </label>
        </div>
        <div>
            <label>Lambert <input type="radio" id="shadingLambert" name="shading" value="Lambert"></label>
            <label>Phong <input type="radio" id="shadingPhong" name="shading" value="Phong" checked></label>
        </div>
        <div>
            <div>
                <label>
                    AmbientMaterial
                    <input type="text" id="ambientMaterial" value="[0.1,0.1,0.1,1.0]">
                </label>
                <label>
                    AmbientLight
                    <input type="text" id="ambientLight" value="[1,0,0,1.0]">
                </label>
            </div>
            <div>
                <label>
                    DiffuseMaterial
                    <input type="text" id="diffuseMaterial" value="[0.5,0.5,0.5,1.0]">
                </label>

                <label>
                    DiffuseLight
                    <input type="text" id="diffuseLight" value="[0,1,0,1.0]">
                </label>
            </div>
            <div>
                <label>
                    SpecularMaterial
                    <input type="text" id="specularMaterial" value="[0.1,0.2,0.4,1.0]">
                </label>
                <label>
                    SpecularLight
                    <input type="text" id="specularLight" value="[0,0,1,1.0]">
                </label>
            </div>
        </div>
    </div>


<div>
    <b>ModelViewMatrix Transformations</b><br>

    <div id="rotation">
        <label>rotateX
            <input type="number" id="rotateX" min="0.0" step="0.005" max="1.0">
        </label><label>rotateY
        <input type="number" id="rotateY" min="0.0" step="0.005" max="1.0">
    </label>
        <label>rotateZ
            <input type="number" id="rotateZ" min="0.0" step="0.005" max="1.0">
        </label>
    </div>

    <div id="scaling">
        <label>scaler
            <input type="range" id="scaler" min="-3.0" step="0.1" max="3.0">
            </label>
        <label>scaleX
            <input type="number" id="scaleX" min="-2.0" step="1" max="2.0">
        </label><label>scaleY
        <input type="number" id="scaleY" min="-2.0" step="0.1" max="2.0">
    </label>
        <label>scaleZ
            <input type="number" id="scaleZ" min="-2.0" step="0.1" max="2.0">
        </label>
        <button id="doScale">do scale</button>
        <button id="undoScale">undo scale</button>
    </div>
    <div id="translation">
        <label>translateX
            <input type="number" id="translateX" min="-1.0" step="0.1" max="1.0">
        </label>
        <label>translateY
            <input type="number" id="translateY" min="/-1.0" step="0.1" max="1.0">
        </label>
        <label>translateZ
            <input type="number" id="translateZ" min="-1.0" step="0.01" max="1.0">
        </label>
        <button id="doTranslate">do translate</button>
        <button id="undoTranslate">undo translate</button>
    </div>
</div>
    <div class="panel">

    <b>Perspective Matrix Transformations</b>
    <select id="setProjection">
    <option value="o">
        Orthographic
    </option>
    <option value="p">Perspective</option>
    </select>


    <label>Near <input id="setNear" type="number" min="0" max="999"></label>
    <label>Far <input id="setFar" type="number" min="1" max="1000" step="1"></label>

    <div>
        <label>Fovy<input type="number" min="1" step=0.5 max="360" id="setFovy"></label>
        <label>Aspect <input type="number" min="-1" id="setAspect"> (-1 == take canvas.w/.h)</label>
        <button id="setPerspective">setPerspective</button>
    </div>
    <div>
        <label>Left <input id="setLeft" type="number" min="0" max="999"></label>
        <label>Right <input id="setRight" type="number" min="0" max="999"></label>
        <label>Top <input id="setTop" type="number" min="0" max="999"></label>
        <label>Bottom <input id="setBottom" type="number" min="1" max="1000" step="1"></label>
        <button id="setFrustum">setFrustum</button>
    </div>


    <div class="panel">

        <b>Camera x/y/z translations</b>
        <input type="range" id="camUp" min="-10" max="10" step="0.01">
        <input type="range" id="camLeft" min="-10" max="10" step="0.01">
        <input type="range" id="camAxis" min="-10" max="10" step="0.01">

        </div>

    </div>
<br style="clear:both">
    <div>
        <img id="textureImage" src="/iam.jpg">
        <input type="file" id="textureFile">
        </div>

</div>


</body>
<script id="vs" type="shader">

attribute vec3 aVertexPosition;
attribute vec4 aVertexColor;
attribute vec3 aVertexNormal;
attribute vec2 aTextureCoord;
varying vec2 vTextureCoord;

uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
uniform mat3 uNMatrix;
uniform bool uPicking;

varying vec3 vNormal;
varying vec3 vEyeVec;

uniform bool uPoints;
uniform float uPointSize;
varying vec4 vVertexColor;

void main(void) {
    vec4 vertex = uMVMatrix * vec4(aVertexPosition, 1.0);
    vNormal = vec3(uNMatrix * aVertexNormal);
    vEyeVec = vec3(vertex.xyz);
    vVertexColor = aVertexColor;
    vTextureCoord = aTextureCoord;
    gl_Position = uPMatrix * vertex;
    if (uPoints) gl_PointSize = uPointSize;
    else gl_PointSize = 1.0;
}
</script>
<script id="fs" type="shader">
precision highp float;
uniform vec3 uLightDirection;
uniform vec4 uAmbientLight;
uniform vec4 uAmbientMaterial;
uniform vec4 uSpecularLight;
uniform vec4 uSpecularMaterial;
uniform vec4 uDiffuseLight;
uniform vec4 uDiffuseMaterial;
uniform float uShininess;
uniform bool uTexture;
uniform float uAlpha;

varying vec3 vNormal;
varying vec3 vEyeVec;
varying vec4 vVertexColor;

uniform sampler2D uSampler;
varying vec2 vTextureCoord;

void main(void) {

    vec3 L = normalize(uLightDirection);
    vec3 N = normalize(vNormal);

    float lambertTerm = dot(N, -L);
    vec4 Ia  = uAmbientLight * uAmbientMaterial;
    vec4 Id  = vec4(0,0,0,1);
    vec4 Is  = vec4(0,0,0,1);

    if (lambertTerm > 0.0) {
        Id = uDiffuseLight * uDiffuseMaterial * lambertTerm;
        vec3 E = normalize(vEyeVec);
        vec3 R = reflect(L, N);
        float specular = pow(max(dot(R,E), 0.0), uShininess);
        Is = uSpecularLight * uSpecularMaterial * specular;
    }

    vec4 finalColor = Ia + Id + Is;
    finalColor.a = 1.0;
    if (uTexture) {
        vec4 texColor = texture2D(uSampler, vTextureCoord);
        gl_FragColor = vec4(texColor.rgb, uAlpha); // vec4(texColor.rgb + finalColor.rgb, 1.0);
    } else {
        gl_FragColor = vec4(vVertexColor.rgb + finalColor.rgb, uAlpha);
    }
}
</script>

<script id="vs1" type="shader">

attribute vec3 aVertexPosition;
attribute vec4 aVertexColor;
attribute vec3 aVertexNormal;
attribute vec2 aTextureCoord;
varying vec2 vTextureCoord;


uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;
uniform mat3 uNMatrix;

uniform mat4 uCamera;
uniform bool uPicking;

uniform bool uPoints;
uniform float uPointSize;

uniform vec4 uAmbientLight;
uniform vec4 uAmbientMaterial;
uniform vec4 uSpecularLight;
uniform vec4 uSpecularMaterial;
uniform vec4 uDiffuseLight;
uniform vec4 uDiffuseMaterial;
uniform vec4 uOffScreenColor;

// const int numLights = 4;

uniform vec3 uLightPosition;
uniform vec3 uLightDirection;

uniform float uAlpha;
uniform float uShininess;

uniform vec4 uPickingColor;
varying vec4 vVertexColor;

varying vec4 vAmbientLight;
varying vec4 vDiffuseLight;
varying vec4 vSpecularLight;

varying float vAlpha;
varying vec3 vLightDirection;

uniform bool uOffScreen;

void main() {

    vec4 vertex = uMVMatrix * vec4(aVertexPosition, 1.0);

    if (uOffScreen) {

        vVertexColor = uOffScreenColor;

    } else {
        vec3 lightPos = vec3(uMVMatrix * vec4(uLightPosition, 1.0));
        vec3 lightRay = vertex.xyz - lightPos.xyz;
        vec3 N = uNMatrix * aVertexNormal;
        vec3 L = normalize(lightRay);
        float lambertTerm = dot(N, -L);

        vAmbientLight = vec4(0.0,0.0,0.0,1.0); // uAmbientLight * uAmbientMaterial;
        vDiffuseLight = vec4(0.0,0.0,0.0,1.0); // white
        vSpecularLight = vec4(0.0,0.0,0.0,1.0); // white

        if (lambertTerm > 0.0) {
            //  diffuse
            vDiffuseLight = uDiffuseLight * uDiffuseMaterial * lambertTerm;
            // specular
            vec3 eyeVec = -vec3(vertex.xyz);
            vec3 E = normalize(eyeVec);
            vec3 R = reflect(L, N);
            float specular = pow(max(dot(R, E), 0.0), uShininess);
            vSpecularLight = uSpecularLight * uSpecularMaterial * specular;
        }
        vTextureCoord = aTextureCoord;
        vVertexColor = vec4(aVertexColor.rgb, uAlpha);
    }

    vAlpha = uAlpha;
    gl_Position = uPMatrix * vertex;
    if (uPoints) gl_PointSize = uPointSize;
    else gl_PointSize = 1.0;
}




</script>

<script id="fs1" type="shader">
precision highp float;

varying vec4 vVertexColor;
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform bool uTexture;

varying vec4 vAmbientLight;
varying vec4 vDiffuseLight;
varying vec4 vSpecularLight;

varying float vAlpha;
varying vec3 vLightDirection;

void main() {
    vec4 color;
    if (uTexture) {
        vec4 texColor = texture2D(uSampler, vTextureCoord);
        color = vec4(texColor.rgb, vAlpha); // * vec4(vDiffuseLight.rgb + vAmbientLight.rgb + vSpecularLight.rgb, vAlpha);
    } else {
        color = vVertexColor + vDiffuseLight;
    }
    gl_FragColor = color;
}



</script>
<script src="/scripts/webgl-debug.js"></script>
<script src="/scripts/gl-matrix.js"></script>
<script id="webglapp">

var grid = {
    "alias" : "Grid_Grid_None",
    "vertices" : [-1.97583,0.0,-1.97583,-1.536756,0.0,-1.97583,-1.097683,0.0,-1.97583,-0.65861,0.0,-1.97583,-0.219537,0.0,-1.97583,0.219537,0.0,-1.97583,0.65861,0.0,-1.97583,1.097683,0.0,-1.97583,1.536756,0.0,-1.97583,1.975829,0.0,-1.97583,-1.97583,0.0,-1.536756,-1.536756,0.0,-1.536756,-1.097683,0.0,-1.536756,-0.65861,0.0,-1.536756,-0.219537,0.0,-1.536756,0.219537,0.0,-1.536756,0.65861,0.0,-1.536756,1.097683,0.0,-1.536756,1.536756,0.0,-1.536756,1.975829,0.0,-1.536756,-1.97583,0.0,-1.097683,-1.536756,0.0,-1.097683,-1.097683,0.0,-1.097683,-0.65861,0.0,-1.097683,-0.219537,0.0,-1.097683,0.219537,0.0,-1.097683,0.65861,0.0,-1.097683,1.097683,0.0,-1.097683,1.536756,0.0,-1.097683,1.975829,0.0,-1.097683,-1.97583,0.0,-0.65861,-1.536756,0.0,-0.65861,-1.097683,0.0,-0.65861,-0.65861,0.0,-0.65861,-0.219537,0.0,-0.65861,0.219537,0.0,-0.65861,0.65861,0.0,-0.65861,1.097683,0.0,-0.65861,1.536756,0.0,-0.65861,1.975829,0.0,-0.65861,-1.97583,0.0,-0.219537,-1.536756,0.0,-0.219537,-1.097683,0.0,-0.219537,-0.65861,0.0,-0.219537,-0.219537,0.0,-0.219537,0.219537,0.0,-0.219537,0.65861,0.0,-0.219537,1.097683,0.0,-0.219537,1.536756,0.0,-0.219537,1.975829,0.0,-0.219537,-1.97583,0.0,0.219537,-1.536756,0.0,0.219537,-1.097683,0.0,0.219537,-0.65861,0.0,0.219537,-0.219537,0.0,0.219537,0.219537,0.0,0.219537,0.65861,0.0,0.219537,1.097683,0.0,0.219537,1.536756,0.0,0.219537,1.975829,0.0,0.219537,-1.97583,0.0,0.65861,-1.536756,0.0,0.65861,-1.097683,0.0,0.65861,-0.65861,0.0,0.65861,-0.219537,0.0,0.65861,0.219537,0.0,0.65861,0.65861,0.0,0.65861,1.097683,0.0,0.65861,1.536756,0.0,0.65861,1.975829,0.0,0.65861,-1.97583,0.0,1.097683,-1.536756,0.0,1.097683,-1.097683,0.0,1.097683,-0.65861,0.0,1.097683,-0.219537,0.0,1.097683,0.219537,0.0,1.097683,0.65861,0.0,1.097683,1.097683,0.0,1.097683,1.536756,0.0,1.097683,1.975829,0.0,1.097683,-1.97583,0.0,1.536756,-1.536756,0.0,1.536756,-1.097683,0.0,1.536756,-0.65861,0.0,1.536756,-0.219537,0.0,1.536756,0.219537,0.0,1.536756,0.65861,0.0,1.536756,1.097683,0.0,1.536756,1.536756,0.0,1.536756,1.975829,0.0,1.536756,-1.97583,0.0,1.975829,-1.536756,0.0,1.975829,-1.097683,0.0,1.975829,-0.65861,0.0,1.975829,-0.219537,0.0,1.975829,0.219537,0.0,1.975829,0.65861,0.0,1.975829,1.097683,0.0,1.975829,1.536756,0.0,1.975829,1.975829,0.0,1.975829],
    "indices" : [2,1,11,9,8,18,3,2,12,4,3,13,5,4,14,6,5,15,7,6,16,1,0,10,8,7,17,16,15,25,17,16,26,11,10,20,18,17,27,12,11,21,19,18,28,13,12,22,14,13,23,15,14,24,25,24,34,26,25,35,27,26,36,21,20,30,28,27,37,22,21,31,29,28,38,23,22,32,24,23,33,35,34,44,36,35,45,37,36,46,31,30,40,38,37,47,32,31,41,39,38,48,33,32,42,34,33,43,44,43,53,45,44,54,46,45,55,47,46,56,41,40,50,48,47,57,42,41,51,49,48,58,43,42,52,54,53,63,55,54,64,56,55,65,57,56,66,51,50,60,58,57,67,52,51,61,59,58,68,53,52,62,69,68,78,63,62,72,64,63,73,65,64,74,66,65,75,67,66,76,61,60,70,68,67,77,62,61,71,79,78,88,73,72,82,74,73,83,75,74,84,76,75,85,77,76,86,71,70,80,78,77,87,72,71,81,88,87,97,82,81,91,89,88,98,83,82,92,84,83,93,85,84,94,86,85,95,87,86,96,81,80,90,12,2,11,19,9,18,13,3,12,14,4,13,15,5,14,16,6,15,17,7,16,11,1,10,18,8,17,26,16,25,27,17,26,21,11,20,28,18,27,22,12,21,29,19,28,23,13,22,24,14,23,25,15,24,35,25,34,36,26,35,37,27,36,31,21,30,38,28,37,32,22,31,39,29,38,33,23,32,34,24,33,45,35,44,46,36,45,47,37,46,41,31,40,48,38,47,42,32,41,49,39,48,43,33,42,44,34,43,54,44,53,55,45,54,56,46,55,57,47,56,51,41,50,58,48,57,52,42,51,59,49,58,53,43,52,64,54,63,65,55,64,66,56,65,67,57,66,61,51,60,68,58,67,62,52,61,69,59,68,63,53,62,79,69,78,73,63,72,74,64,73,75,65,74,76,66,75,77,67,76,71,61,70,78,68,77,72,62,71,89,79,88,83,73,82,84,74,83,85,75,84,86,76,85,87,77,86,81,71,80,88,78,87,82,72,81,98,88,97,92,82,91,99,89,98,93,83,92,94,84,93,95,85,94,96,86,95,97,87,96,91,81,90],
    "Ka" : [0.00000,0.00000,0.00000],
    "d" : 1.00000,
    "Kd" : [0.80000,0.80000,0.80000],
    "illum" : 2,
    "Ks" : [0.80000,0.80000,0.80000],
    "Ns" : 0.00000
};
var models = {};
models.grid = grid;




function Light() {
    this._lights = [];
}
Light.prototype = {
    origin: function (vec_3) {
        return this._position = vec3.create([0, 0, 0]);
    },
    setPosition: function (vec_3) {
        return this._position = vec3.create(vec_3);
    },
    setAmbient: function (vec_4) {
        return this._ambient = vec4.create(vec_4);
    },
    setDiffuse: function (vec_4) {
        return this._diffuse = vec4.create(vec_4);
    },
    setSpecular: function (vec_4) {
        return this._specular = vec4.create(vec_4);
    }
};


function Material() {
}
Material.prototype = {
    diffuse: function (vec_4) {
        return this._diffuse = vec4.create(vec_4);
    }
}

function Lights() {
    this._lights = [];
}
Lights.prototype = {
    add: function (light) {
        this._lights.push(light);
    },
    getArray: function (type) {
        var a = [];
        this._lights.forEach(function (light) {
            a = a.concat(light["_" + type]);
        });
        return a;
    }
};
function makeFloor(gl) {
    var floorData = [

        -0.5, 0.0, -0.5,
        -0.5, 0, 0.5,
        0.5, 0, -0.5,

        0.5, 0, -0.5,
        -0.5, 0 , 0.5,
        0.5, 0, 0.5

    ];
    var floorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, floorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(floorData), gl.STATIC_DRAW);
    floorBuffer.numItems = 6;
    floorBuffer.itemSize = 3;

    var colorData = [
        0.8, 0.14, 0.55, 1.0,
        0.8, 0.24, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0,

        0.8, 0.44, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0,
        0.8, 0.64, 0.55, 1.0,

        0.8, 0.74, 0.55, 1.0,
        0.8, 0.84, 0.55, 1.0,
        0.8, 0.94, 0.55, 1.0,

        0.8, 0.14, 0.55, 1.0,
        0.8, 0.24, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0
    ];
    var colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colorData), gl.STATIC_DRAW);
    colorBuffer.numItems = 12;
    colorBuffer.itemSize = 4;


    var texCoords = [

        0.0, 0.0,
        1.0, 0.0,
        1.0, 1.0,
        1.0, 1.0,
        1.0, 0.0,
        0.0, 1.0
    ];

    var tcBuf = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, tcBuf);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(texCoords), gl.STATIC_DRAW);
    tcBuf.numItems = 6;
    tcBuf.itemSize = 2;

    return {v: floorBuffer, c: colorBuffer, tc: texCoords, t: loadTexture(gl, "/iam_old.jpg")}
}

function makeSphere(gl) {
    var sphereBuffer = gl.createBuffer();
    var model = {};
    model.vertices = [-0.195090, 0.980785, 0.000000
        , -0.382683, 0.923880, 0.000000
        , -0.555570, 0.831470, 0.000000
        , -0.707107, 0.707107, 0.000000
        , -0.831470, 0.555570, 0.000000
        , -0.923880, 0.382683, 0.000000
        , -0.980785, 0.195090, 0.000000
        , -1.000000, 0.000000, 0.000000
        , -0.980785, -0.195090, 0.000000
        , -0.923880, -0.382683, 0.000000
        , -0.831470, -0.555570, 0.000000
        , -0.707107, -0.707107, 0.000000
        , -0.555570, -0.831470, 0.000000
        , -0.382683, -0.923880, 0.000000
        , -0.195090, -0.980785, 0.000000
        , 0.000000, -1.000000, 0.000000
        , -0.191342, 0.980785, -0.038060
        , -0.375330, 0.923880, -0.074658
        , -0.544895, 0.831470, -0.108386
        , -0.693520, 0.707107, -0.137950
        , -0.815493, 0.555570, -0.162212
        , -0.906127, 0.382683, -0.180240
        , -0.961940, 0.195090, -0.191342
        , -0.980785, 0.000000, -0.195090
        , -0.961940, -0.195090, -0.191342
        , -0.906127, -0.382683, -0.180240
        , -0.815493, -0.555570, -0.162212
        , -0.693520, -0.707107, -0.137950
        , -0.544895, -0.831470, -0.108386
        , -0.375330, -0.923880, -0.074658
        , -0.191341, -0.980785, -0.038060
        , -0.180240, 0.980785, -0.074658
        , -0.353553, 0.923880, -0.146447
        , -0.513280, 0.831470, -0.212608
        , -0.653281, 0.707107, -0.270598
        , -0.768178, 0.555570, -0.318190
        , -0.853553, 0.382683, -0.353553
        , -0.906127, 0.195090, -0.375330
        , -0.923880, 0.000000, -0.382684
        , -0.906127, -0.195090, -0.375330
        , -0.853553, -0.382683, -0.353554
        , -0.768178, -0.555570, -0.318190
        , -0.653281, -0.707107, -0.270598
        , -0.513280, -0.831470, -0.212608
        , -0.353553, -0.923880, -0.146447
        , -0.180240, -0.980785, -0.074658
        , -0.162212, 0.980785, -0.108387
        , -0.318190, 0.923880, -0.212608
        , -0.461940, 0.831470, -0.308658
        , -0.587938, 0.707107, -0.392848
        , -0.691342, 0.555570, -0.461940
        , -0.768178, 0.382683, -0.513280
        , -0.815493, 0.195090, -0.544895
        , -0.831470, 0.000000, -0.555570
        , -0.815493, -0.195090, -0.544895
        , -0.768178, -0.382683, -0.513280
        , -0.691342, -0.555570, -0.461940
        , -0.587938, -0.707107, -0.392848
        , -0.461940, -0.831470, -0.308658
        , -0.318189, -0.923880, -0.212608
        , -0.162211, -0.980785, -0.108386
        , -0.137950, 0.980785, -0.137950
        , -0.270598, 0.923880, -0.270598
        , -0.392847, 0.831470, -0.392848
        , -0.500000, 0.707107, -0.500000
        , -0.587938, 0.555570, -0.587938
        , -0.653281, 0.382683, -0.653282
        , -0.693520, 0.195090, -0.693520
        , -0.707107, 0.000000, -0.707107
        , -0.693520, -0.195090, -0.693520
        , -0.653281, -0.382683, -0.653282
        , -0.587938, -0.555570, -0.587938
        , -0.500000, -0.707107, -0.500000
        , -0.392847, -0.831470, -0.392848
        , -0.270598, -0.923880, -0.270598
        , -0.137949, -0.980785, -0.137950
        , -0.108386, 0.980785, -0.162212
        , -0.212607, 0.923880, -0.318190
        , -0.308658, 0.831470, -0.461940
        , -0.392847, 0.707107, -0.587938
        , -0.461939, 0.555570, -0.691342
        , -0.513280, 0.382683, -0.768178
        , -0.544895, 0.195090, -0.815493
        , -0.555570, 0.000000, -0.831470
        , -0.544895, -0.195090, -0.815493
        , -0.513280, -0.382683, -0.768178
        , -0.461939, -0.555570, -0.691342
        , -0.392847, -0.707107, -0.587938
        , -0.308658, -0.831470, -0.461940
        , -0.212607, -0.923880, -0.318190
        , -0.108386, -0.980785, -0.162212
        , -0.074658, 0.980785, -0.180240
        , -0.146446, 0.923880, -0.353554
        , -0.212607, 0.831470, -0.513280
        , -0.270598, 0.707107, -0.653282
        , -0.318189, 0.555570, -0.768178
        , -0.353553, 0.382683, -0.853554
        , -0.375330, 0.195090, -0.906128
        , -0.382683, 0.000000, -0.923880
        , -0.375330, -0.195090, -0.906128
        , -0.353553, -0.382683, -0.853554
        , -0.318189, -0.555570, -0.768178
        , -0.270598, -0.707107, -0.653282
        , -0.212607, -0.831470, -0.513280
        , -0.146446, -0.923880, -0.353554
        , -0.074658, -0.980785, -0.180240
        , -0.038060, 0.980785, -0.191342
        , -0.074658, 0.923880, -0.375331
        , -0.108386, 0.831470, -0.544895
        , -0.137949, 0.707107, -0.693520
        , -0.162211, 0.555570, -0.815493
        , -0.180240, 0.382683, -0.906128
        , -0.191341, 0.195090, -0.961940
        , -0.195090, 0.000000, -0.980785
        , -0.191341, -0.195090, -0.961940
        , -0.180240, -0.382683, -0.906128
        , -0.162211, -0.555570, -0.815493
        , -0.137949, -0.707107, -0.693520
        , -0.108386, -0.831470, -0.544895
        , -0.074658, -0.923880, -0.375330
        , -0.038060, -0.980785, -0.191342
        , 0.000000, 0.980785, -0.195091
        , 0.000000, 0.923880, -0.382684
        , 0.000000, 0.831470, -0.555570
        , 0.000000, 0.707107, -0.707107
        , 0.000000, 0.555570, -0.831470
        , 0.000000, 0.382683, -0.923880
        , 0.000000, 0.195090, -0.980785
        , 0.000000, 0.000000, -1.000000
        , 0.000000, -0.195090, -0.980785
        , 0.000000, -0.382683, -0.923880
        , 0.000000, -0.555570, -0.831470
        , 0.000000, -0.707107, -0.707107
        , 0.000000, -0.831470, -0.555570
        , 0.000000, -0.923880, -0.382684
        , 0.000000, -0.980785, -0.195090
        , 0.038061, 0.980785, -0.191342
        , 0.074658, 0.923880, -0.375330
        , 0.108387, 0.831470, -0.544895
        , 0.137950, 0.707107, -0.693520
        , 0.162212, 0.555570, -0.815493
        , 0.180240, 0.382683, -0.906128
        , 0.191342, 0.195090, -0.961940
        , 0.195091, 0.000000, -0.980785
        , 0.191342, -0.195090, -0.961940
        , 0.180240, -0.382683, -0.906128
        , 0.162212, -0.555570, -0.815493
        , 0.137950, -0.707107, -0.693520
        , 0.108387, -0.831470, -0.544895
        , 0.074658, -0.923880, -0.375330
        , 0.038061, -0.980785, -0.191342
        , 0.074658, 0.980785, -0.180240
        , 0.146447, 0.923880, -0.353554
        , 0.212608, 0.831470, -0.513280
        , 0.270599, 0.707107, -0.653282
        , 0.318190, 0.555570, -0.768178
        , 0.353554, 0.382683, -0.853553
        , 0.375331, 0.195090, -0.906127
        , 0.382684, 0.000000, -0.923880
        , 0.375331, -0.195090, -0.906127
        , 0.353554, -0.382683, -0.853554
        , 0.318190, -0.555570, -0.768178
        , 0.270599, -0.707107, -0.653282
        , 0.212608, -0.831470, -0.513280
        , 0.146447, -0.923880, -0.353553
        , 0.074658, -0.980785, -0.180240
        , 0.108387, 0.980785, -0.162212
        , 0.212608, 0.923880, -0.318190
        , 0.308659, 0.831470, -0.461940
        , 0.392848, 0.707107, -0.587938
        , 0.461940, 0.555570, -0.691342
        , 0.513280, 0.382683, -0.768178
        , 0.544895, 0.195090, -0.815493
        , 0.555571, 0.000000, -0.831470
        , 0.544895, -0.195090, -0.815493
        , 0.513280, -0.382683, -0.768178
        , 0.461940, -0.555570, -0.691342
        , 0.392848, -0.707107, -0.587938
        , 0.308659, -0.831470, -0.461940
        , 0.212608, -0.923880, -0.318190
        , 0.108387, -0.980785, -0.162212
        , 0.137950, 0.980785, -0.137950
        , 0.270599, 0.923880, -0.270598
        , 0.392848, 0.831470, -0.392848
        , 0.500000, 0.707107, -0.500000
        , 0.587938, 0.555570, -0.587938
        , 0.653282, 0.382683, -0.653281
        , 0.693520, 0.195090, -0.693520
        , 0.707107, 0.000000, -0.707107
        , 0.693520, -0.195090, -0.693520
        , 0.653282, -0.382683, -0.653282
        , 0.587938, -0.555570, -0.587938
        , 0.500000, -0.707107, -0.500000
        , 0.392848, -0.831470, -0.392847
        , 0.270598, -0.923880, -0.270598
        , 0.137950, -0.980785, -0.137950
        , 0.162212, 0.980785, -0.108386
        , 0.318190, 0.923880, -0.212608
        , 0.461940, 0.831470, -0.308658
        , 0.587938, 0.707107, -0.392847
        , 0.691342, 0.555570, -0.461940
        , 0.768178, 0.382683, -0.513280
        , 0.815493, 0.195090, -0.544895
        , 0.831470, 0.000000, -0.555570
        , 0.815493, -0.195090, -0.544895
        , 0.768178, -0.382683, -0.513280
        , 0.691342, -0.555570, -0.461940
        , 0.587938, -0.707107, -0.392847
        , 0.461940, -0.831470, -0.308658
        , 0.318190, -0.923880, -0.212608
        , 0.162212, -0.980785, -0.108386
        , 0.180240, 0.980785, -0.074658
        , 0.353554, 0.923880, -0.146447
        , 0.513280, 0.831470, -0.212608
        , 0.653282, 0.707107, -0.270598
        , 0.768178, 0.555570, -0.318190
        , 0.853554, 0.382683, -0.353553
        , 0.906128, 0.195090, -0.375330
        , 0.923880, 0.000000, -0.382683
        , 0.906128, -0.195090, -0.375330
        , 0.853554, -0.382683, -0.353553
        , 0.768178, -0.555570, -0.318190
        , 0.653282, -0.707107, -0.270598
        , 0.513280, -0.831470, -0.212607
        , 0.353554, -0.923880, -0.146447
        , 0.180240, -0.980785, -0.074658
        , 0.191342, 0.980785, -0.038060
        , 0.375331, 0.923880, -0.074658
        , 0.544896, 0.831470, -0.108386
        , 0.693520, 0.707107, -0.137950
        , 0.815493, 0.555570, -0.162212
        , 0.906128, 0.382683, -0.180240
        , 0.961940, 0.195090, -0.191342
        , 0.980785, 0.000000, -0.195090
        , 0.961940, -0.195090, -0.191342
        , 0.906128, -0.382683, -0.180240
        , 0.815493, -0.555570, -0.162212
        , 0.693520, -0.707107, -0.137950
        , 0.544895, -0.831470, -0.108386
        , 0.375331, -0.923880, -0.074658
        , 0.191342, -0.980785, -0.038060
        , 0.195091, 0.980785, 0.000000
        , 0.382684, 0.923880, 0.000000
        , 0.555571, 0.831470, 0.000000
        , 0.707107, 0.707107, 0.000000
        , 0.831470, 0.555570, 0.000000
        , 0.923880, 0.382683, 0.000000
        , 0.980785, 0.195090, 0.000000
        , 1.000000, 0.000000, 0.000000
        , 0.980785, -0.195090, 0.000000
        , 0.923880, -0.382683, 0.000000
        , 0.831470, -0.555570, 0.000000
        , 0.707107, -0.707107, 0.000000
        , 0.555571, -0.831470, 0.000000
        , 0.382684, -0.923880, 0.000000
        , 0.195091, -0.980785, 0.000000
        , 0.191342, 0.980785, 0.038060
        , 0.375331, 0.923880, 0.074658
        , 0.544896, 0.831470, 0.108386
        , 0.693520, 0.707107, 0.137950
        , 0.815493, 0.555570, 0.162212
        , 0.906128, 0.382683, 0.180240
        , 0.961940, 0.195090, 0.191342
        , 0.980785, 0.000000, 0.195090
        , 0.961940, -0.195090, 0.191342
        , 0.906128, -0.382683, 0.180240
        , 0.815493, -0.555570, 0.162212
        , 0.693520, -0.707107, 0.137950
        , 0.544895, -0.831470, 0.108386
        , 0.375331, -0.923880, 0.074658
        , 0.191342, -0.980785, 0.038060
        , 0.180240, 0.980785, 0.074658
        , 0.353554, 0.923880, 0.146447
        , 0.513280, 0.831470, 0.212608
        , 0.653282, 0.707107, 0.270598
        , 0.768178, 0.555570, 0.318190
        , 0.853554, 0.382683, 0.353554
        , 0.906128, 0.195090, 0.375330
        , 0.923880, 0.000000, 0.382683
        , 0.906128, -0.195090, 0.375330
        , 0.853554, -0.382683, 0.353553
        , 0.768178, -0.555570, 0.318190
        , 0.653282, -0.707107, 0.270598
        , 0.513280, -0.831470, 0.212608
        , 0.353554, -0.923880, 0.146447
        , 0.180240, -0.980785, 0.074658
        , 0.162212, 0.980785, 0.108387
        , 0.318190, 0.923880, 0.212608
        , 0.461940, 0.831470, 0.308658
        , 0.587938, 0.707107, 0.392848
        , 0.691342, 0.555570, 0.461940
        , 0.768178, 0.382683, 0.513280
        , 0.815493, 0.195090, 0.544895
        , 0.831470, 0.000000, 0.555570
        , 0.815493, -0.195090, 0.544895
        , 0.768178, -0.382683, 0.513280
        , 0.691342, -0.555570, 0.461940
        , 0.587938, -0.707107, 0.392848
        , 0.461940, -0.831470, 0.308658
        , 0.318190, -0.923880, 0.212608
        , 0.162212, -0.980785, 0.108386
        , 0.137950, 0.980785, 0.137950
        , 0.270598, 0.923880, 0.270598
        , 0.392848, 0.831470, 0.392848
        , 0.500000, 0.707107, 0.500000
        , 0.587938, 0.555570, 0.587938
        , 0.653282, 0.382683, 0.653282
        , 0.693520, 0.195090, 0.693520
        , 0.707107, 0.000000, 0.707107
        , 0.693520, -0.195090, 0.693520
        , 0.653282, -0.382683, 0.653282
        , 0.587938, -0.555570, 0.587938
        , 0.500000, -0.707107, 0.500000
        , 0.392848, -0.831470, 0.392848
        , 0.270598, -0.923880, 0.270598
        , 0.137950, -0.980785, 0.137950
        , 0.108387, 0.980785, 0.162212
        , 0.212608, 0.923880, 0.318190
        , 0.308659, 0.831470, 0.461940
        , 0.392848, 0.707107, 0.587938
        , 0.461940, 0.555570, 0.691342
        , 0.513280, 0.382683, 0.768178
        , 0.544895, 0.195090, 0.815493
        , 0.555570, 0.000000, 0.831469
        , 0.544895, -0.195090, 0.815493
        , 0.513280, -0.382683, 0.768178
        , 0.461940, -0.555570, 0.691342
        , 0.392848, -0.707107, 0.587938
        , 0.308659, -0.831470, 0.461940
        , 0.212608, -0.923880, 0.318190
        , 0.108387, -0.980785, 0.162212
        , 0.074658, 0.980785, 0.180240
        , 0.146447, 0.923880, 0.353554
        , 0.212608, 0.831470, 0.513280
        , 0.270598, 0.707107, 0.653281
        , 0.318190, 0.555570, 0.768178
        , 0.353554, 0.382683, 0.853553
        , 0.375330, 0.195090, 0.906127
        , 0.382683, 0.000000, 0.923879
        , 0.375330, -0.195090, 0.906127
        , 0.353554, -0.382683, 0.853553
        , 0.318190, -0.555570, 0.768178
        , 0.270598, -0.707107, 0.653281
        , 0.212608, -0.831470, 0.513280
        , 0.146447, -0.923880, 0.353553
        , 0.074658, -0.980785, 0.180240
        , 0.038061, 0.980785, 0.191342
        , 0.074658, 0.923880, 0.375330
        , 0.108387, 0.831470, 0.544895
        , 0.137950, 0.707107, 0.693520
        , 0.162212, 0.555570, 0.815493
        , 0.180240, 0.382683, 0.906127
        , 0.191342, 0.195090, 0.961940
        , 0.195090, 0.000000, 0.980785
        , 0.191342, -0.195090, 0.961940
        , 0.180240, -0.382683, 0.906128
        , 0.162212, -0.555570, 0.815493
        , 0.137950, -0.707107, 0.693520
        , 0.108387, -0.831470, 0.544895
        , 0.074658, -0.923880, 0.375330
        , 0.038061, -0.980785, 0.191342
        , 0.000000, 0.980785, 0.195090
        , 0.000000, 0.923880, 0.382684
        , 0.000000, 0.831470, 0.555570
        , 0.000000, 0.707107, 0.707107
        , 0.000000, 0.555570, 0.831469
        , 0.000000, 0.382683, 0.923879
        , 0.000000, 0.195090, 0.980785
        , 0.000000, 0.000000, 1.000000
        , 0.000000, -0.195090, 0.980785
        , 0.000000, -0.382683, 0.923880
        , 0.000000, -0.555570, 0.831469
        , 0.000000, -0.707107, 0.707107
        , 0.000000, -0.831470, 0.555570
        , 0.000000, -0.923880, 0.382683
        , 0.000000, -0.980785, 0.195090
        , -0.038060, 0.980785, 0.191342
        , -0.074658, 0.923880, 0.375330
        , -0.108386, 0.831470, 0.544895
        , -0.137949, 0.707107, 0.693520
        , -0.162211, 0.555570, 0.815493
        , -0.180240, 0.382683, 0.906127
        , -0.191342, 0.195090, 0.961939
        , -0.195090, 0.000000, 0.980785
        , -0.191342, -0.195090, 0.961939
        , -0.180240, -0.382683, 0.906127
        , -0.162211, -0.555570, 0.815493
        , -0.137949, -0.707107, 0.693520
        , -0.108386, -0.831470, 0.544895
        , -0.074658, -0.923880, 0.375330
        , -0.038060, -0.980785, 0.191342
        , 0.000000, 1.000000, 0.000000
        , -0.074658, 0.980785, 0.180240
        , -0.146446, 0.923880, 0.353553
        , -0.212607, 0.831470, 0.513280
        , -0.270598, 0.707107, 0.653281
        , -0.318189, 0.555570, 0.768177
        , -0.353553, 0.382683, 0.853553
        , -0.375330, 0.195090, 0.906127
        , -0.382683, 0.000000, 0.923879
        , -0.375330, -0.195090, 0.906127
        , -0.353553, -0.382683, 0.853553
        , -0.318189, -0.555570, 0.768177
        , -0.270598, -0.707107, 0.653281
        , -0.212607, -0.831470, 0.513280
        , -0.146446, -0.923880, 0.353553
        , -0.074657, -0.980785, 0.180240
        , -0.108386, 0.980785, 0.162212
        , -0.212607, 0.923880, 0.318190
        , -0.308658, 0.831470, 0.461940
        , -0.392847, 0.707107, 0.587938
        , -0.461939, 0.555570, 0.691341
        , -0.513280, 0.382683, 0.768178
        , -0.544895, 0.195090, 0.815493
        , -0.555570, 0.000000, 0.831469
        , -0.544895, -0.195090, 0.815493
        , -0.513280, -0.382683, 0.768178
        , -0.461939, -0.555570, 0.691341
        , -0.392847, -0.707107, 0.587938
        , -0.308658, -0.831470, 0.461940
        , -0.212607, -0.923880, 0.318190
        , -0.108386, -0.980785, 0.162212
        , -0.137949, 0.980785, 0.137950
        , -0.270598, 0.923880, 0.270598
        , -0.392847, 0.831470, 0.392847
        , -0.500000, 0.707107, 0.500000
        , -0.587937, 0.555570, 0.587937
        , -0.653281, 0.382683, 0.653281
        , -0.693519, 0.195090, 0.693519
        , -0.707106, 0.000000, 0.707106
        , -0.693519, -0.195090, 0.693519
        , -0.653281, -0.382683, 0.653281
        , -0.587937, -0.555570, 0.587937
        , -0.500000, -0.707107, 0.500000
        , -0.392847, -0.831470, 0.392847
        , -0.270598, -0.923880, 0.270598
        , -0.137949, -0.980785, 0.137950
        , -0.162211, 0.980785, 0.108386
        , -0.318189, 0.923880, 0.212608
        , -0.461939, 0.831470, 0.308658
        , -0.587937, 0.707107, 0.392847
        , -0.691341, 0.555570, 0.461939
        , -0.768177, 0.382683, 0.513280
        , -0.815493, 0.195090, 0.544895
        , -0.831469, 0.000000, 0.555570
        , -0.815493, -0.195090, 0.544895
        , -0.768178, -0.382683, 0.513280
        , -0.691341, -0.555570, 0.461939
        , -0.587937, -0.707107, 0.392847
        , -0.461939, -0.831470, 0.308658
        , -0.318189, -0.923880, 0.212608
        , -0.162211, -0.980785, 0.108386
        , -0.180240, 0.980785, 0.074658
        , -0.353553, 0.923880, 0.146447
        , -0.513280, 0.831470, 0.212607
        , -0.653281, 0.707107, 0.270598
        , -0.768177, 0.555570, 0.318189
        , -0.853553, 0.382683, 0.353553
        , -0.906127, 0.195090, 0.375330
        , -0.923879, 0.000000, 0.382683
        , -0.906127, -0.195090, 0.375330
        , -0.853553, -0.382683, 0.353553
        , -0.768177, -0.555570, 0.318189
        , -0.653281, -0.707107, 0.270598
        , -0.513280, -0.831470, 0.212607
        , -0.353553, -0.923880, 0.146447
        , -0.180240, -0.980785, 0.074658
        , -0.191341, 0.980785, 0.038060
        , -0.375330, 0.923880, 0.074658
        , -0.544895, 0.831470, 0.108386
        , -0.693520, 0.707107, 0.137950
        , -0.815492, 0.555570, 0.162211
        , -0.906127, 0.382683, 0.180240
        , -0.961939, 0.195090, 0.191341
        , -0.980784, 0.000000, 0.195090
        , -0.961939, -0.195090, 0.191341
        , -0.906127, -0.382683, 0.180240
        , -0.815492, -0.555570, 0.162211
        , -0.693520, -0.707107, 0.137950
        , -0.544895, -0.831470, 0.108386
        , -0.375330, -0.923880, 0.074658
        , -0.191341, -0.980785, 0.038060];

    model.indices = [
        13, 12, 28, 29
        , 7, 6, 22, 23
        , 14, 13, 29, 30
        , 8, 7, 23, 24
        , 2, 1, 17, 18
        , 15, 14, 30, 31
        , 9, 8, 24, 25
        , 3, 2, 18, 19
        , 10, 9, 25, 26
        , 4, 3, 19, 20
        , 11, 10, 26, 27
        , 5, 4, 20, 21
        , 12, 11, 27, 28
        , 6, 5, 21, 22
        , 31, 30, 45, 46
        , 25, 24, 39, 40
        , 19, 18, 33, 34
        , 26, 25, 40, 41
        , 20, 19, 34, 35
        , 27, 26, 41, 42
        , 21, 20, 35, 36
        , 28, 27, 42, 43
        , 22, 21, 36, 37
        , 29, 28, 43, 44
        , 23, 22, 37, 38
        , 30, 29, 44, 45
        , 24, 23, 38, 39
        , 18, 17, 32, 33
        , 44, 43, 58, 59
        , 38, 37, 52, 53
        , 45, 44, 59, 60
        , 39, 38, 53, 54
        , 33, 32, 47, 48
        , 46, 45, 60, 61
        , 40, 39, 54, 55
        , 34, 33, 48, 49
        , 41, 40, 55, 56
        , 35, 34, 49, 50
        , 42, 41, 56, 57
        , 36, 35, 50, 51
        , 43, 42, 57, 58
        , 37, 36, 51, 52
        , 57, 56, 71, 72
        , 51, 50, 65, 66
        , 58, 57, 72, 73
        , 52, 51, 66, 67
        , 59, 58, 73, 74
        , 53, 52, 67, 68
        , 60, 59, 74, 75
        , 54, 53, 68, 69
        , 48, 47, 62, 63
        , 61, 60, 75, 76
        , 55, 54, 69, 70
        , 49, 48, 63, 64
        , 56, 55, 70, 71
        , 50, 49, 64, 65
        , 76, 75, 90, 91
        , 70, 69, 84, 85
        , 64, 63, 78, 79
        , 71, 70, 85, 86
        , 65, 64, 79, 80
        , 72, 71, 86, 87
        , 66, 65, 80, 81
        , 73, 72, 87, 88
        , 67, 66, 81, 82
        , 74, 73, 88, 89
        , 68, 67, 82, 83
        , 75, 74, 89, 90
        , 69, 68, 83, 84
        , 63, 62, 77, 78
        , 89, 88, 103, 104
        , 83, 82, 97, 98
        , 90, 89, 104, 105
        , 84, 83, 98, 99
        , 78, 77, 92, 93
        , 91, 90, 105, 106
        , 85, 84, 99, 100
        , 79, 78, 93, 94
        , 86, 85, 100, 101
        , 80, 79, 94, 95
        , 87, 86, 101, 102
        , 81, 80, 95, 96
        , 88, 87, 102, 103
        , 82, 81, 96, 97
        , 102, 101, 116, 117
        , 96, 95, 110, 111
        , 103, 102, 117, 118
        , 97, 96, 111, 112
        , 104, 103, 118, 119
        , 98, 97, 112, 113
        , 105, 104, 119, 120
        , 99, 98, 113, 114
        , 93, 92, 107, 108
        , 106, 105, 120, 121
        , 100, 99, 114, 115
        , 94, 93, 108, 109
        , 101, 100, 115, 116
        , 95, 94, 109, 110
        , 108, 107, 122, 123
        , 121, 120, 135, 136
        , 115, 114, 129, 130
        , 109, 108, 123, 124
        , 116, 115, 130, 131
        , 110, 109, 124, 125
        , 117, 116, 131, 132
        , 111, 110, 125, 126
        , 118, 117, 132, 133
        , 112, 111, 126, 127
        , 119, 118, 133, 134
        , 113, 112, 127, 128
        , 120, 119, 134, 135
        , 114, 113, 128, 129
        , 127, 126, 141, 142
        , 134, 133, 148, 149
        , 128, 127, 142, 143
        , 135, 134, 149, 150
        , 129, 128, 143, 144
        , 123, 122, 137, 138
        , 136, 135, 150, 151
        , 130, 129, 144, 145
        , 124, 123, 138, 139
        , 131, 130, 145, 146
        , 125, 124, 139, 140
        , 132, 131, 146, 147
        , 126, 125, 140, 141
        , 133, 132, 147, 148
        , 146, 145, 160, 161
        , 140, 139, 154, 155
        , 147, 146, 161, 162
        , 141, 140, 155, 156
        , 148, 147, 162, 163
        , 142, 141, 156, 157
        , 149, 148, 163, 164
        , 143, 142, 157, 158
        , 150, 149, 164, 165
        , 144, 143, 158, 159
        , 138, 137, 152, 153
        , 151, 150, 165, 166
        , 145, 144, 159, 160
        , 139, 138, 153, 154
        , 165, 164, 179, 180
        , 159, 158, 173, 174
        , 153, 152, 167, 168
        , 166, 165, 180, 181
        , 160, 159, 174, 175
        , 154, 153, 168, 169
        , 161, 160, 175, 176
        , 155, 154, 169, 170
        , 162, 161, 176, 177
        , 156, 155, 170, 171
        , 163, 162, 177, 178
        , 157, 156, 171, 172
        , 164, 163, 178, 179
        , 158, 157, 172, 173
        , 178, 177, 192, 193
        , 172, 171, 186, 187
        , 179, 178, 193, 194
        , 173, 172, 187, 188
        , 180, 179, 194, 195
        , 174, 173, 188, 189
        , 168, 167, 182, 183
        , 181, 180, 195, 196
        , 175, 174, 189, 190
        , 169, 168, 183, 184
        , 176, 175, 190, 191
        , 170, 169, 184, 185
        , 177, 176, 191, 192
        , 171, 170, 185, 186
        , 191, 190, 205, 206
        , 185, 184, 199, 200
        , 192, 191, 206, 207
        , 186, 185, 200, 201
        , 193, 192, 207, 208
        , 187, 186, 201, 202
        , 194, 193, 208, 209
        , 188, 187, 202, 203
        , 195, 194, 209, 210
        , 189, 188, 203, 204
        , 183, 182, 197, 198
        , 196, 195, 210, 211
        , 190, 189, 204, 205
        , 184, 183, 198, 199
        , 210, 209, 224, 225
        , 204, 203, 218, 219
        , 198, 197, 212, 213
        , 211, 210, 225, 226
        , 205, 204, 219, 220
        , 199, 198, 213, 214
        , 206, 205, 220, 221
        , 200, 199, 214, 215
        , 207, 206, 221, 222
        , 201, 200, 215, 216
        , 208, 207, 222, 223
        , 202, 201, 216, 217
        , 209, 208, 223, 224
        , 203, 202, 217, 218
        , 223, 222, 237, 238
        , 217, 216, 231, 232
        , 224, 223, 238, 239
        , 218, 217, 232, 233
        , 225, 224, 239, 240
        , 219, 218, 233, 234
        , 213, 212, 227, 228
        , 226, 225, 240, 241
        , 220, 219, 234, 235
        , 214, 213, 228, 229
        , 221, 220, 235, 236
        , 215, 214, 229, 230
        , 222, 221, 236, 237
        , 216, 215, 230, 231
        , 236, 235, 250, 251
        , 230, 229, 244, 245
        , 237, 236, 251, 252
        , 231, 230, 245, 246
        , 238, 237, 252, 253
        , 232, 231, 246, 247
        , 239, 238, 253, 254
        , 233, 232, 247, 248
        , 240, 239, 254, 255
        , 234, 233, 248, 249
        , 228, 227, 242, 243
        , 241, 240, 255, 256
        , 235, 234, 249, 250
        , 229, 228, 243, 244
        , 255, 254, 269, 270
        , 249, 248, 263, 264
        , 243, 242, 257, 258
        , 256, 255, 270, 271
        , 250, 249, 264, 265
        , 244, 243, 258, 259
        , 251, 250, 265, 266
        , 245, 244, 259, 260
        , 252, 251, 266, 267
        , 246, 245, 260, 261
        , 253, 252, 267, 268
        , 247, 246, 261, 262
        , 254, 253, 268, 269
        , 248, 247, 262, 263
        , 261, 260, 275, 276
        , 268, 267, 282, 283
        , 262, 261, 276, 277
        , 269, 268, 283, 284
        , 263, 262, 277, 278
        , 270, 269, 284, 285
        , 264, 263, 278, 279
        , 258, 257, 272, 273
        , 271, 270, 285, 286
        , 265, 264, 279, 280
        , 259, 258, 273, 274
        , 266, 265, 280, 281
        , 260, 259, 274, 275
        , 267, 266, 281, 282
        , 280, 279, 294, 295
        , 274, 273, 288, 289
        , 281, 280, 295, 296
        , 275, 274, 289, 290
        , 282, 281, 296, 297
        , 276, 275, 290, 291
        , 283, 282, 297, 298
        , 277, 276, 291, 292
        , 284, 283, 298, 299
        , 278, 277, 292, 293
        , 285, 284, 299, 300
        , 279, 278, 293, 294
        , 273, 272, 287, 288
        , 286, 285, 300, 301
        , 299, 298, 313, 314
        , 293, 292, 307, 308
        , 300, 299, 314, 315
        , 294, 293, 308, 309
        , 288, 287, 302, 303
        , 301, 300, 315, 316
        , 295, 294, 309, 310
        , 289, 288, 303, 304
        , 296, 295, 310, 311
        , 290, 289, 304, 305
        , 297, 296, 311, 312
        , 291, 290, 305, 306
        , 298, 297, 312, 313
        , 292, 291, 306, 307
        , 312, 311, 326, 327
        , 306, 305, 320, 321
        , 313, 312, 327, 328
        , 307, 306, 321, 322
        , 314, 313, 328, 329
        , 308, 307, 322, 323
        , 315, 314, 329, 330
        , 309, 308, 323, 324
        , 303, 302, 317, 318
        , 316, 315, 330, 331
        , 310, 309, 324, 325
        , 304, 303, 318, 319
        , 311, 310, 325, 326
        , 305, 304, 319, 320
        , 331, 330, 345, 346
        , 325, 324, 339, 340
        , 319, 318, 333, 334
        , 326, 325, 340, 341
        , 320, 319, 334, 335
        , 327, 326, 341, 342
        , 321, 320, 335, 336
        , 328, 327, 342, 343
        , 322, 321, 336, 337
        , 329, 328, 343, 344
        , 323, 322, 337, 338
        , 330, 329, 344, 345
        , 324, 323, 338, 339
        , 318, 317, 332, 333
        , 344, 343, 358, 359
        , 338, 337, 352, 353
        , 345, 344, 359, 360
        , 339, 338, 353, 354
        , 333, 332, 347, 348
        , 346, 345, 360, 361
        , 340, 339, 354, 355
        , 334, 333, 348, 349
        , 341, 340, 355, 356
        , 335, 334, 349, 350
        , 342, 341, 356, 357
        , 336, 335, 350, 351
        , 343, 342, 357, 358
        , 337, 336, 351, 352
        , 357, 356, 371, 372
        , 351, 350, 365, 366
        , 358, 357, 372, 373
        , 352, 351, 366, 367
        , 359, 358, 373, 374
        , 353, 352, 367, 368
        , 360, 359, 374, 375
        , 354, 353, 368, 369
        , 348, 347, 362, 363
        , 361, 360, 375, 376
        , 355, 354, 369, 370
        , 349, 348, 363, 364
        , 356, 355, 370, 371
        , 350, 349, 364, 365
        , 376, 375, 390, 391
        , 370, 369, 384, 385
        , 364, 363, 378, 379
        , 371, 370, 385, 386
        , 365, 364, 379, 380
        , 372, 371, 386, 387
        , 366, 365, 380, 381
        , 373, 372, 387, 388
        , 367, 366, 381, 382
        , 374, 373, 388, 389
        , 368, 367, 382, 383
        , 375, 374, 389, 390
        , 369, 368, 383, 384
        , 363, 362, 377, 378
        , 389, 388, 404, 405
        , 383, 382, 398, 399
        , 390, 389, 405, 406
        , 384, 383, 399, 400
        , 378, 377, 393, 394
        , 391, 390, 406, 407
        , 385, 384, 400, 401
        , 379, 378, 394, 395
        , 386, 385, 401, 402
        , 380, 379, 395, 396
        , 387, 386, 402, 403
        , 381, 380, 396, 397
        , 388, 387, 403, 404
        , 382, 381, 397, 398
        , 396, 395, 410, 411
        , 403, 402, 417, 418
        , 397, 396, 411, 412
        , 404, 403, 418, 419
        , 398, 397, 412, 413
        , 405, 404, 419, 420
        , 399, 398, 413, 414
        , 406, 405, 420, 421
        , 400, 399, 414, 415
        , 394, 393, 408, 409
        , 407, 406, 421, 422
        , 401, 400, 415, 416
        , 395, 394, 409, 410
        , 402, 401, 416, 417
        , 415, 414, 429, 430
        , 409, 408, 423, 424
        , 422, 421, 436, 437
        , 416, 415, 430, 431
        , 410, 409, 424, 425
        , 417, 416, 431, 432
        , 411, 410, 425, 426
        , 418, 417, 432, 433
        , 412, 411, 426, 427
        , 419, 418, 433, 434
        , 413, 412, 427, 428
        , 420, 419, 434, 435
        , 414, 413, 428, 429
        , 421, 420, 435, 436
        , 434, 433, 448, 449
        , 428, 427, 442, 443
        , 435, 434, 449, 450
        , 429, 428, 443, 444
        , 436, 435, 450, 451
        , 430, 429, 444, 445
        , 424, 423, 438, 439
        , 437, 436, 451, 452
        , 431, 430, 445, 446
        , 425, 424, 439, 440
        , 432, 431, 446, 447
        , 426, 425, 440, 441
        , 433, 432, 447, 448
        , 427, 426, 441, 442
        , 447, 446, 461, 462
        , 441, 440, 455, 456
        , 448, 447, 462, 463
        , 442, 441, 456, 457
        , 449, 448, 463, 464
        , 443, 442, 457, 458
        , 450, 449, 464, 465
        , 444, 443, 458, 459
        , 451, 450, 465, 466
        , 445, 444, 459, 460
        , 439, 438, 453, 454
        , 452, 451, 466, 467
        , 446, 445, 460, 461
        , 440, 439, 454, 455
        , 466, 465, 480, 481
        , 460, 459, 474, 475
        , 454, 453, 468, 469
        , 467, 466, 481, 482
        , 461, 460, 475, 476
        , 455, 454, 469, 470
        , 462, 461, 476, 477
        , 456, 455, 470, 471
        , 463, 462, 477, 478
        , 457, 456, 471, 472
        , 464, 463, 478, 479
        , 458, 457, 472, 473
        , 465, 464, 479, 480
        , 459, 458, 473, 474
        , 1, 392, 17
        , 16, 15, 31
        , 16, 31, 46
        , 17, 392, 32
        , 32, 392, 47
        , 16, 46, 61
        , 47, 392, 62
        , 16, 61, 76
        , 16, 76, 91
        , 62, 392, 77
        , 77, 392, 92
        , 16, 91, 106
        , 92, 392, 107
        , 16, 106, 121
        , 16, 121, 136
        , 107, 392, 122
        , 122, 392, 137
        , 16, 136, 151
        , 137, 392, 152
        , 16, 151, 166
        , 16, 166, 181
        , 152, 392, 167
        , 167, 392, 182
        , 16, 181, 196
        , 16, 196, 211
        , 182, 392, 197
        , 16, 211, 226
        , 197, 392, 212
        , 212, 392, 227
        , 16, 226, 241
        , 16, 241, 256
        , 227, 392, 242
        , 242, 392, 257
        , 16, 256, 271
        , 257, 392, 272
        , 16, 271, 286
        , 16, 286, 301
        , 272, 392, 287
        , 287, 392, 302
        , 16, 301, 316
        , 302, 392, 317
        , 16, 316, 331
        , 16, 331, 346
        , 317, 392, 332
        , 332, 392, 347
        , 16, 346, 361
        , 347, 392, 362
        , 16, 361, 376
        , 16, 376, 391
        , 362, 392, 377
        , 377, 392, 393
        , 16, 391, 407
        , 393, 392, 408
        , 16, 407, 422
        , 16, 422, 437
        , 408, 392, 423
        , 423, 392, 438
        , 16, 437, 452
        , 16, 452, 467
        , 438, 392, 453
        , 16, 467, 482
        , 453, 392, 468
        , 479, 478, 11, 12
        , 473, 472, 5, 6
        , 480, 479, 12, 13
        , 474, 473, 6, 7
        , 468, 392, 1
        , 481, 480, 13, 14
        , 475, 474, 7, 8
        , 469, 468, 1, 2
        , 482, 481, 14, 15
        , 476, 475, 8, 9
        , 470, 469, 2, 3
        , 16, 482, 15
        , 477, 476, 9, 10
        , 471, 470, 3, 4
        , 478, 477, 10, 11
        , 472, 471, 4, 5
    ];

    var colors = [];
    for (var i = 0, j = model.indices.length * 4; i < j; i++) colors.push(rand());

    var colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);
    colorBuffer.numItems = Math.floor(colors.length / 4);
    colorBuffer.itemSize = 4;

    var sphereBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, sphereBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.vertices), gl.STATIC_DRAW);
    sphereBuffer.numItems = Math.floor(model.vertices.length / 3);
    sphereBuffer.itemSize = 3;

    var sphereIndexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphereIndexBuffer);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(model.indices), gl.STATIC_DRAW);
    sphereIndexBuffer.itemSize = 1;
    sphereIndexBuffer.numItems = Math.floor(model.indices.length / 1);

    return { v: sphereBuffer, i: sphereIndexBuffer, c: colorBuffer };

}

function makeSquare(gl) {
    var vertices = [-50.0, 50.0, 0.0,
        -50.0, -50.0, 0.0,
        50.0, -50.0, 0.0,
        50.0, 50.0, 0.0];
}

function makeCone(gl) {

    var model = {
        "vertices": [
            -0.5, 0, 0,
            -0.5, 1, 0,
            -0.5, 0.809017, 0.587785,
            -0.5, 0.309017, 0.951057,
            -0.5, -0.309017, 0.951057,
            -0.5, -0.809017, 0.587785,
            -0.5, 1, 0,
            -0.5, 0.2, -0.587785,
            -0.5, 0.7, -0.951057,
            -0.5, 1.309017, 0.1,
            -0.5, 1.809017, 0.4
        ],
        "indices": [

            0, 1, 2,
            0, 2, 3,
            0, 3, 4,
            0, 4, 5,
            0, 5, 6,
            0, 6, 7,
            0, 7, 8,
            0, 8, 9,
            0, 9, 10,
            0, 10, 1]
    };

    var colors = [];
    for (var i = 0, j = 36; i < j; i++) {
        colors.push(0.0);
        colors.push(1.0);
        colors.push(0.0);
        colors.push(1.0);
    }


    var colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);
    colorBuffer.numItems = Math.floor(colors.length / 4);
    colorBuffer.itemSize = 4;

    var coneBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, coneBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.vertices), gl.STATIC_DRAW);
    coneBuffer.numItems = Math.floor(model.vertices.length / 3);
    coneBuffer.itemSize = 3;

    var coneIndexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, coneIndexBuffer);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(model.indices), gl.STATIC_DRAW);
    coneIndexBuffer.itemSize = 1;
    coneIndexBuffer.numItems = Math.floor(model.indices.length / 1);

    return { v: coneBuffer, i: coneIndexBuffer, c: colorBuffer };
}

function makeTrapezoid(gl) {
    var trapezoidBuffer = gl.createBuffer();
    var indexBuffer = gl.createBuffer();
    var colorBuffer = gl.createBuffer();

    var model = {

        vertices: [
            -1.5, -1.5, 0.0,
            -0.5, 1.5, 0.0,
            0.0, -1.5, 0.0,
            0.5, 1.5, 0.0,
            1.5, -1.5, 0.0
        ],

        indices: [
            0, 1, 2, 0, 2, 3, 2, 3, 4
        ],
        colors: [
        ]
    };
    var colors = [
        1.0, 0.0, 0.0, 1.0,
        0.0, 1.0, 0.0, 1.0,
        0.0, 0.0, 1.0, 1.0
    ]

    for (var i = 0, j = Math.floor(model.indices.length); i < j; i++) {
        model.colors = model.colors.concat(colors);
    }

    gl.bindBuffer(gl.ARRAY_BUFFER, trapezoidBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.vertices), gl.STATIC_DRAW);
    trapezoidBuffer.itemSize = 3;
    trapezoidBuffer.numItems = Math.floor(model.vertices / 3);


    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(model.indices), gl.STATIC_DRAW);
    indexBuffer.itemSize = 1;
    indexBuffer.numItems = Math.floor(model.indices.length);


    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.colors), gl.STATIC_DRAW);
    colorBuffer.itemSize = 4;
    colorBuffer.numItems = Math.floor(model.colors / 4);


    return { v: trapezoidBuffer, i: indexBuffer, c: colorBuffer };
}

function makeTriangle(gl) {
    var triangleData = [
        0.0, 0.5, 0.0,
        -0.5, -0.5, 0.0,
        0.5, -0.5, 0.0
    ];
    var triangleColor = [
        1.0, 1.0, 1.0, 1.0,
        0.9, 0.454, 0.23, 1.0,
        0.1, 1.0, 1.0, 1.0
    ];
    var triangleBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, triangleBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(triangleData), gl.STATIC_DRAW);
    triangleBuffer.numItems = 3;
    triangleBuffer.itemSize = 3;

    var triangleColorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, triangleColorBuffer)
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(triangleColor), gl.STATIC_DRAW);
    triangleColorBuffer.numItems = 3;
    triangleColorBuffer.itemSize = 4;
    return { v: triangleBuffer, c: triangleColorBuffer };
}


function rand() {
    return Math.floor(Math.random() * 10) / 10;
}


function makeWall(gl) {
    var wallData = [
        0, 0, 0.5,
        0, 0, -0.5,
        0, 0.5, -0.5,

        0, 0.5, -0.5,
        0, 0.5, 0.5,
        0, 0, 0.5
    ];

    var wallBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, wallBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(wallData), gl.STATIC_DRAW);
    wallBuffer.numItems = 6;
    wallBuffer.itemSize = 3;
    var colorData = [
        0.8, 0.14, 0.55, 1.0,
        0.8, 0.24, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0,

        0.8, 0.44, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0,
        0.8, 0.64, 0.55, 1.0,

        0.8, 0.74, 0.55, 1.0,
        0.8, 0.84, 0.55, 1.0,
        0.8, 0.94, 0.55, 1.0,

        0.8, 0.14, 0.55, 1.0,
        0.8, 0.24, 0.55, 1.0,
        0.8, 0.54, 0.55, 1.0
    ];
    var colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colorData), gl.STATIC_DRAW);
    colorBuffer.numItems = 12;
    colorBuffer.itemSize = 4;
    return {v: wallBuffer, c: colorBuffer};
}

function makeVBO(gl,model,itemSize, key) {
    if (itemSize==undefined) itemSize = 3;
    if (key==undefined) key="vertices";
    var vbo = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model[key]), gl.STATIC_DRAW);
    vbo.itemSize = itemSize;
    vbo.numItems = model.vertices.length / itemSize;
    return vbo;
}
function makeColorBuffer(gl, model) {
    return makeVBO(gl, model, 4, "colors");
}



function makeIBO(gl,model) {
    var ibo = gl.createBuffer();
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(model.indices), gl.STATIC_DRAW);
    ibo.itemSize = 1;
    ibo.numItems = model.indices.length;
    return ibo;
}

function makeGrid(gl) {
    var grid = models.grid;
    var vbo = makeVBO(gl,grid);
    var ibo = makeIBO(gl,grid);
    return { v: vbo, i: ibo };
}

function makeCube(gl) {
    var model = {};

    model.vertices = [
        0.6, 0.6, 0.6,
        -0.6, 0.6, 0.6,
        -0.6, -0.6, 0.6,
        0.6, -0.6, 0.6,
        0.6, 0.6, -0.6,
        -0.6, 0.6, -0.6,
        -0.6, -0.6, -0.6,
        0.6, -0.6, -0.6,
        -0.6, 0.6, 0.6,
        -0.6, 0.6, -0.6,
        -0.6, -0.6, -0.6,
        -0.6, -0.6, 0.6,
        0.6, 0.6, 0.6,
        0.6, -0.6, 0.6,
        0.6, -0.6, -0.6,
        0.6, 0.6, -0.6,
        0.6, 0.6, 0.6,
        0.6, 0.6, -0.6,
        -0.6, 0.6, -0.6,
        -0.6, 0.6, 0.6,
        0.6, -0.6, 0.6,
        0.6, -0.6, -0.6,
        -0.6, -0.6, -0.6,
        -0.6, -0.6, 0.6
    ];

    model.colors = [];
    for (var i = 0, j = 4 * 6 * 4; i < j; i++) model.colors.push(rand());

    model.indices = [
        0, 1, 2,
        0, 2, 3, // Front face
        4, 6, 5,
        4, 7, 6, // Back face
        8, 9, 10,
        8, 10, 11, // Left face
        12, 13, 14,
        12, 14, 15, // Right face
        16, 17, 18,
        16, 18, 19, // Top face
        20, 22, 21,
        20, 23, 22 // Bottom face
    ];

    model.texcoords = [
        0.0, 1.0,
        1.0, 0.0,
        1.0, 1.0,
        0.0, 0.0,
            1.0, 0.0,
            0.0, 1.0,

    ];
    for (var i = 0, j = 6; i < j; i++) model.texcoords = model.texcoords.concat(model.texcoords);

    var cubeBuffer = makeVBO(gl,model);

    var cubeIndexBuffer = makeIBO(gl,model);
    

    var colorBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.colors), gl.STATIC_DRAW);
    colorBuffer.numItems = 4;
    colorBuffer.itemSize = 24;

    var texCoords = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, texCoords);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(model.texcoords), gl.STATIC_DRAW);
    texCoords.numItems = 36;
    texCoords.itemSize = 2;

    return { v: cubeBuffer, i: cubeIndexBuffer, c: colorBuffer, sc: [0.5,0.5,0.5,1.0], t: loadTexture(gl, "/js1.jpg"), tc: texCoords };
}


function makeProgram(gl) {
    var vs = gl.createShader(gl.VERTEX_SHADER);
    var fs = gl.createShader(gl.FRAGMENT_SHADER);

    gl.shaderSource(vs, document.getElementById("vs").textContent);
    gl.shaderSource(fs, document.getElementById("fs").textContent);
    gl.compileShader(vs);
    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {
        alert(gl.getShaderInfoLog(vs));
    }
    gl.compileShader(fs);
    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {
        alert(gl.getShaderInfoLog(fs));
    }
    program = gl.createProgram();
    gl.attachShader(program, vs);
    gl.attachShader(program, fs);
    gl.linkProgram(program);
    gl.useProgram(program);
    program.vs = vs;
    program.fs = fs;
    return program;
}

function status(msg) {
    document.getElementById("statusMessages").innerHTML = msg;
}

function texOnload (gl, texBuf) {
    gl.bindTexture(gl.TEXTURE_2D, texBuf);
    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texImg); // upload texture
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
};

function loadTexture (gl, url, texBuff) {
    "use strict";

    var tex = texBuff||gl.createTexture();

    texImg.onload = function (e) {
        texOnload(gl, tex);
    };
    texImg.src = url;

    return tex;
}

var texImg = document.getElementById("textureImage");
var texFile = document.getElementById("textureFile");
texFile.onchange = function (e) {
    var r = (new FileReader);
    r.onloadend = function (e) {
        texImg.src = r.result;
        cubeBuffers.t = texOnload(gl, cubeBuffers.t);
    };
    r.readAsDataURL(this.files[0]);
};

function init() {

    function Camera() {
        this.uCamera = mat4.create();
        this.position = [0,0,0]
    }

    Camera.prototype = {
        setPosition: function(vec) {
            this.position = vec;
        }
    };


    function Transforms() {
        this.mvstack = []
        this.COORDS_WORLD = 1;
        this.COORDS_CAMERA = 2;
        this.uCamera = mat4.create();
        this.uMVMatrix = mat4.create();
        this.uNMatrix = mat4.create();

    }
    Transforms.prototype = {
        init: function () {
            mat4.identity(this.uMVMatrix);
        },
        push: function () {
            var m = mat4.create();
            mat4.set(m, this.uMVMatrix);
            this.mvstack.push(m);
        },
        pop: function () {
            this.uMVMatrix = m;
        }
    };

    var transforms = new Transforms();


    var camUp = document.getElementById("camUp");
    var camLeft = document.getElementById("camLeft");
    var camAxis = document.getElementById("camAxis");

    var cup = vec4.create(), cleft = vec4.create(), caxis = vec4.create();

    camUp.onchange = function (e) {

       vec4.scale(cup, [1, this.value, 1]);
       draw();
       //mat4.translate(uniforms.uCamera, uniforms.uCamera, [0,camUp, 0]);
    };
    camLeft.onchange = function (e) {
        vec4.scale(cleft, [this.value, 1, 1]);
        //mat4.translate(uniforms.uCamera, uniforms.uCamera, [camLeft, 0, 0]);
        draw();
    };
    camAxis.onchange = function (e) {
        vec4.scale(caxis, [1,1,this.value]);
       //mat4.translate(uniforms.uCamera, uniforms.uCamera, [0, 0, camAxis])
        draw();

    };



    var useColorArray = false;
    var useTexture = false;

    var animate = false
    var rotateX = 0.000, rotateY = 0.004, rotateZ = 0.000;
    var scaleX = 1, scaleY = 1, scaleZ = 1;
    var translateX = 0, translateY = 0, translateZ = 0;

    var rX = document.getElementById("rotateX");
    var rY = document.getElementById("rotateY");
    var rZ = document.getElementById("rotateZ");

    var sX = document.getElementById("scaleX");
    var sY = document.getElementById("scaleY");
    var sZ = document.getElementById("scaleZ");

    var tX = document.getElementById("translateX");
    var tY = document.getElementById("translateY");
    var tZ = document.getElementById("translateZ");

    var uC = document.getElementById("useColors");
    var dm = document.getElementById("drawingModes");

    var selectedDrawingMode = document.getElementById("selectedDrawingMode");


    var setProjection = document.getElementById("setProjection");
    setProjection.onchange = function (e) {
        var options = this.querySelectorAll("option");
        if (options[0].checked) PROJ = PROJ_ORTHO;
        else PROJ = PROJ_PERS;
        updateProjection();
    };

    function updateProjection() {
        if (PROJ == PROJ_ORTHO) {
            setOrthographic();
        } else {
            setPerspective();
        }
        if (!animate) requestAnimationFrame(draw);
    }

    function parseVec(v, len) {
        try {
            var vec = JSON.parse(v);
            if (Array.isArray(vec) && vec.length == len) {
                return vec4.create(vec);
            } else {
                status("can´t create vector. is no array or length is wrong.");
            }
        } catch (ex) {
            status("can´t parse vector");
        }
    }




    // DrawingMode selection
    var drawingMode = "TRIANGLES";
    dm.addEventListener("change", function (e) {
        var options = this.querySelectorAll("option");
        for (var i = 0, j = options.length; i < j; i++) {
            var option = options[i];
            if (option.selected) {
                drawingMode = option.value;
                selectedDrawingMode.innerHTML = drawingMode;
                if (drawingMode === "POINTS") uniforms.uPoints = true;
                else uniforms.uPoints = false;
                //if (!animate) render();
            }
        }
    });


    // Mesh sElection
    var selectedMesh = "Cube";
    var sm = document.getElementById("meshSelection");
    sm.addEventListener("change", function (e) {
        var options = this.querySelectorAll("option");
        for (var i = 0, j = options.length; i < j; i++) {
            var option = options[i];

            if (option.selected) {
                selectedMesh = option.value;
                selectedMeshInfo.innerHTML = selectedMesh;
                if (!animate) requestAnimationFrame(draw);
                initUniforms();
                initMatrix();

                gl.bindTexture(gl.TEXTURE_2D, null);
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
                gl.bindBuffer(gl.ARRAY_BUFFER, null);
            }
        }
        /*
         uMVMatrix = uniforms.uMVMatrix = mvm.pop();
         uNMatrix = uniforms.uNMatrix = nm.pop();
         mvm.push(mat4.create(uMVMatrix));
         nm.push(mat3.create(uNMatrix));*/
    });


    var alphaChannel = document.getElementById("alphaChannel");
    alphaChannel.addEventListener("change", function (e) {
        uAlpha = +this.value;
    });

    /**
     * *******************************************************************************************************
     * ROTATION
     * *******************************************************************************************************
     */

    rX.addEventListener("change", function (e) {
        rotateX = +this.value;
    });
    rY.addEventListener("change", function (e) {
        rotateY = +this.value;
    });
    rZ.addEventListener("change", function (e) {
        rotateZ = +this.value;
    });

    /**
     * *******************************************************************************************************
     * TRANSLATION
     * *******************************************************************************************************
     */

    tX.addEventListener("change", function (e) {
        translateX = +this.value;
        mat4.translate(uMVMatrix, uMVMatrix, [translateX, 0, 0]);
    });
    tY.addEventListener("change", function (e) {
        translateY = +this.value;
        mat4.translate(uMVMatrix, uMVMatrix, [0, translateY, 0]);
    });
    tZ.addEventListener("change", function (e) {
        translateZ = +this.value;
        mat4.translate(uMVMatrix, uMVMatrix, [0, 0, translateZ]);
    });

    var translatestack = [];
    var translateButton = document.getElementById("doTranslate");
    var translateRestore = document.getElementById("undoTranslate");
    // translate button + restore (use mvmstack)
    translateButton.onclick = function () {
        translatestack.push(mat4.create(uMVMatrix));
        mat4.translate(uMVMatrix, uMVMatrix, [translateX, translateY, translateZ]);
        if (!animate) requestAnimationFrame(draw);
    };
    translateRestore.onclick = function () {
        uMVMatrix = uniforms.uMVMatrix = translatestack.pop();
        if (!animate) requestAnimationFrame(draw);
    };

    /**
     * *******************************************************************************************************
     * SCALING
     * *******************************************************************************************************
     */
    // translate button required + restore
    var scaler = document.getElementById("scaler");
    scaler.addEventListener("change", function (e) {
        mat4.scale(uniforms.uMVMatrix, uniforms.uMVMatrix, [+this.value, +this.value, +this.value]);
        gl.uniformMatrix4fv(program.uMVMatrix, false, uniforms.uMVMatrix);
    })
    sX.addEventListener("change", function (e) {
        scaleX = +this.value;
    });
    sY.addEventListener("change", function (e) {
        scaleY = +this.value;
    });
    sZ.addEventListener("change", function (e) {
        scaleZ = +this.value;
    });



    var uT = document.getElementById("useTexture");
    uT.addEventListener("change", function (e) {
        useTexture = uT.checked;
        if (!animate) requestAnimationFrame(draw);
    });

    uC.addEventListener("change", function (e) {
        useColorArray = uC.checked;
        if (!animate) requestAnimationFrame(draw);
    });
    var drawButton = document.getElementById("drawButton");
    drawButton.addEventListener("click", function (e) {
        if (!animate) requestAnimationFrame(draw);
    })

    var scalestack = [];
    var scaleButton = document.getElementById("doScale");
    var scaleRestore = document.getElementById("undoScale");
    // scale button + restore (use mvmstack)
    scaleButton.onclick = function () {
        scalestack.push(mat4.create(uMVMatrix));
        mat4.scale(uMVMatrix, uMVMatrix, [scaleX, scaleY, scaleZ]);
        if (!animate) requestAnimationFrame(draw);
    };
    scaleRestore.onclick = function () {
        uMVMatrix = uniforms.uMVMatrix = scalestack.pop();
        if (!animate) requestAnimationFrame(draw);
    };


    var repeatDraw = document.getElementById("repeatDraw");
    repeatDraw.addEventListener("change", function (e) {
        animate = !animate;
        if (animate) startAnim(1000 / 60);
        else stopAnim();
        //requestAnimationFrame(draw
        // );
    });


    var canvas, gl;
    var canvas_id = "canvas";
    var cwidth, cheight;
    getContext(canvas_id);


    function onResize() {
        cwidth = canvas.width;
        cheight = canvas.height;
    }

    window.addEventListener("resize", onResize, false);


    function getContext(canvas_id) {
        canvas = document.querySelector(canvas_id);
        gl = canvas.getContext("webgl") || canvas.getContext("webgl-experimental");
        gl = WebGLDebugUtils.makeDebugContext(gl);
        onResize();
    }

    var gridBuffers = makeGrid(gl);
    var floorBuffers = makeFloor(gl);
    var wallBuffers = makeWall(gl);
    var sphereBuffers = makeSphere(gl);
    var triangleBuffers = makeTriangle(gl);
    var cubeBuffers = makeCube(gl);
    var coneBuffers = makeCone(gl);
    var trapezoidBuffers = makeTrapezoid(gl);


    gl.clearColor(0, 0, 0, 1);

    var uniforms = {};
    // 4 lights like in the book
    // c d -z
    // a b +z
    //
    var lights = createLights();

    function createLights() {
        var lightA = new Light();
        lightA.setAmbient([0.4, 0.1, 0.3, 1.0]);
        lightA.setDiffuse([0.2, 0.5, 0.6, 0.5]);
        lightA.setSpecular([0.6, 0.7, 0.8, 0.5]);
        var lightB = new Light();
        var lightC = new Light();
        var lightD = new Light();




    }

    var material = new Material();


    var uNMatrix, uPMatrix, uMVMatrix, uCamera, program;

    program = makeProgram(gl);


    function SceneTransforms () {
        this.uMVMatrix = mat4.create();
        this.uPMatrix = mat4.create();
        this.uNMatrix = mat3.create();
    }
    SceneTransforms.prototype = {
        applyTransforms: function () {

        },
        uploadMatrix: function () {

        }
    };

    function initUniforms() {

        uniforms.uAlpha = 1.0;
        uniforms.uPicking = false;
        uniforms.uNMatrix = mat3.create();
        uniforms.uMVMatrix = mat4.create();
        uniforms.uPMatrix = mat4.create();
        uniforms.uCamera = mat4.create();

        uniforms.uPoints = false;
        uniforms.uOffScreen = false;
        uniforms.uPicking = false;
        uniforms.uPointSize = 20.0;

        uniforms.uLightPosition = [1, 1, 1];
        uniforms.uLightDirection = [-2, -2, -2];

        uniforms.uAmbientLight = [0, 0, 0, 1];
        uniforms.uDiffuseLight = [0, 0, 0, 1];
        uniforms.uSpecularLight = [0, 0, 0, 1];

        uniforms.uAmbientMaterial = [0.9, 0.9, 0.9, 1.0];
        uniforms.uDiffuseMaterial = [0.9, 0.9, 0.9, 1.0];
        uniforms.uSpecularMaterial = [0.9, 0.9, 0.9, 1.0];
    }

    var setLightPos = document.getElementById("lightPosition");
    setLightPos.addEventListener("change", function (e) {
       try {
           uniforms.uLightPosition = JSON.parse(this.value);
       } catch(ex) {
           console.error(ex.message);
       }
    });

    var setLightDir = document.getElementById("lightDirection");
    setLightDir.addEventListener("change", function (e) {
        try {
            uniforms.uLightDirection = JSON.parse(this.value);
        } catch(ex) {
            console.error(ex.message);
        }
    });


    var setShininess = document.getElementById("setShininess");
    setShininess.addEventListener("change", function (e) {
        uniforms.uShininess = +this.value;
    });

    var setPointSize = document.getElementById("setPointSize").addEventListener("change", function (e) {
        uniforms.uPointSize = +this.value;
    }, false);



    var setFovy = document.getElementById("setFovy");
    setFovy.onchange = function (e) {
        fovy = +this.value;
        setP.click();
    };
    var setAspect = document.getElementById("setAspect");
    setAspect.onchange = function (e) {
        aspect = +this.value;
        if (aspect === -1) aspect = this.value = canvas.width / canvas.height;
        setP.click();
    };
    var setNear = document.getElementById("setNear");
    setNear.onchange = function (e) {
        near = +this.value;
        if (near > far) {
            far = near+1;
            setFar.value = far;
        }
        setP.click();
    };
    var setFar = document.getElementById("setFar");
    setFar.onchange = function (e) {
        far = +this.value;
        if (far < near) {
            near = far-1;
            setNear.value = near;
        }
        setP.click();
    };


    var setLeft = document.getElementById("setLeft");
    setLeft.onchange = function (e) {
        left = +this.value;
        if (left > right) {
            left = right-1;
            setLeft.value = left;
        }
        setLeft.click();
    };
    var setRight = document.getElementById("setRight");
    setRight.onchange = function (e) {
        left = +this.value;
        if (right < left) {
            right = left+1;
            setRight.value = right;
        }
        setRight.click();
    };
    var setTop = document.getElementById("setTop");
    setTop.onchange = function (e) {
        top = +this.value;
        if (top > bottom) {
            top = bottom-1;
            setTop.value = top;
        }
        setTop.click();
    };
    var setBottom = document.getElementById("setBottom");
    setBottom.onchange = function (e) {
        bottom = +this.value;
        if (bottom > top) {
            bottom = top+1;
            setBottom.value = bottom;
        }
        setBottom.click();
    };

    var setF = document.getElementById("setFrustum");
    setF.onclick = function (e) {
        setFrustum();
        if (!animate) requestAnimationFrame(draw);
    };
    function setFrustum() {
        mat4.frustum(uPMatrix, left, right, top, bottom, near, far);
    }

    var setP = document.getElementById("setPerspective");
    setP.onclick = function(e) {
        setPerspective();
        if (!animate) requestAnimationFrame(draw);
    };

    function setPerspective() {
        mat4.identity(uPMatrix);
        mat4.perspective(uPMatrix, fovy, aspect, near, far, uPMatrix);
    }
    function setOrthographic() {
        mat4.identity(uPMatrix);
        mat4.ortho(left, right, bottom, top, near, far);
    }

    function initMatrix() {

        uNMatrix = uniforms.uNMatrix;
        uPMatrix = uniforms.uPMatrix;
        uMVMatrix = uniforms.uMVMatrix;
        uCamera = uniforms.uCamera;


        mat4.identity(uMVMatrix);
        mat4.identity(uPMatrix);
        mat4.invert(uCamera, uMVMatrix);

        setPerspective();

        mat4.scale(uPMatrix, uPMatrix, [4,4,4]);

        mat4.translate(uPMatrix, uPMatrix, [0,0,-1]);
        //mat4.rotate(uPMatrix, 0.1, [0,0,0], uPMatrix);

        mat4.translate(uMVMatrix, uMVMatrix, [0, 0.2, 0]);
        mat4.rotateX(uMVMatrix, uMVMatrix, -0.50);
        mat4.rotateY(uMVMatrix, uMVMatrix, 0.25);
        mat3.normalFromMat4(uNMatrix, uMVMatrix);
        mat3.transpose(uNMatrix, uNMatrix);
        //mat4.scale(uMVMatrix, uMVMatrix, [1.5, 1.5, 1.5]);
        mvm = [uMVMatrix], nm = [uNMatrix];

        showMatrices();
    }

    var mvm, nm;


    var fovy = 2, aspect = cwidth / cheight, near = 0.1, far = 100;

    var left, right, top, bottom;

    var PROJ_PERS = 1;
    var PROJ_ORTHO = 0;
    var PROJ = PROJ_PERS;


    initUniforms();
    initMatrix();


    var changeMaterialUniform = changeLightUniform;

    function changeLightUniform(name) {
        return function (e) {
            try {
                uniforms[name] = JSON.parse(this.value);
            } catch (ex) {
                console.error(ex.message);
            }
        }
    }

    document.getElementById("ambientLight").addEventListener("change", changeLightUniform("uAmbientLight"));
    document.getElementById("diffuseLight").addEventListener("change", changeLightUniform("uDiffuseLight"));
    document.getElementById("specularLight").addEventListener("change", changeLightUniform("uSpecularLight"));
    document.getElementById("ambientMaterial").addEventListener("change", changeMaterialUniform("uAmbientMaterial"));
    document.getElementById("diffuseMaterial").addEventListener("change", changeMaterialUniform("uDiffuseMaterial"));
    document.getElementById("specularMaterial").addEventListener("change", changeMaterialUniform("uSpecularMaterial"));


    function Program() {
        this._program = gl.createProgram();
        this._vertex = gl.createShader(gl.VERTEX_SHADER);
        this._fragment = gl.createShader(gl.FRAGMENT_SHADER);
    }

    Program.prototype = {
        getAttributes: function (gl, array) {
            return this._attributes = getAttributes(this._program, gl, array)
        },
        getUniforms: function (gl, array) {
            return this._uniforms = getUniforms(this._program, gl, array);
        }
    };

    function getAttributes(program, gl, array) {
        array.forEach(function (key) {
            program[key] = gl.getAttribLocation(program, key);
        });
    }

    function getUniforms(program, gl, array) {
        array.forEach(function (key) {
            program[key] = gl.getUniformLocation(program, key);
        });
    }

    getAttributes(program, gl, [
        "aVertexPosition",
        "aVertexColor",
        "aVertexNormal",
        "aTextureCoord"
    ]);
    getUniforms(program, gl, [
        "uAlpha",
        "uMVMatrix",
        "uPMatrix",
        "uNMatrix",
        "uCamera",
        "uTexture",
        "uPicking",
        "uPickingColor",
        "uOffScreen",
        "uOffScreenColor",
        "uShininess",
        "uLightPosition",
        "uLightDirection",
        "uAmbientLight",
        "uAmbientMaterial",
        "uDiffuseLight",
        "uDiffuseMaterial",
        "uSpecularLight",
        "uSpecularMaterial",
        "uPoints",
        "uPointSize",
        "uSampler"
    ]);

    var setBlending = document.getElementById("setBlending");
    setBlending.onchange = _setBlending;
    function _setBlending() {
        if (this.checked) enableBlending();
        else disableBlending();
    }

    var camPos = [0, 0, 0];
    var camAngle = 0.1;
    var camAxis = [1, 0, 0];

    function transformCamera() {
        mat4.identity(uCamera);
        mat4.invert(uCamera, uMVMatrix);
        mat4.translate(uCamera, uCamera, camPos);
        mat4.translate(uCamera, uCamera, [cleft[0], cup[1], caxis[2]]);
        return uCamera;
    }


    var stack = [];

    function setUniforms() {
        uNMatrix = uniforms.uNMatrix;
        uPMatrix = uniforms.uPMatrix;
        uMVMatrix = uniforms.uMVMatrix;

//        uCamera = uniforms.uCamera;
        transformCamera();

        gl.uniformMatrix4fv(program.uMVMatrix, false, uCamera );
        gl.uniformMatrix4fv(program.uPMatrix, false, uniforms.uPMatrix);
        gl.uniformMatrix3fv(program.uNMatrix, false, uniforms.uNMatrix);
        gl.uniform1i(program.uTexture, uniforms.uTexture);
        gl.uniform1i(program.uOffScreen, uniforms.uOffScreen);
        gl.uniform1i(program.uPoints, uniforms.uPoints);
        gl.uniform1f(program.uPointSize, uniforms.uPointSize);

        gl.uniform1f(program.uAlpha, uniforms.uAlpha);
        gl.uniform1f(program.uShininess, uniforms.uShininess);
        gl.uniform3fv(program.uLightPosition, uniforms.uLightPosition);
        gl.uniform3fv(program.uLightDirection, uniforms.uLightDirection);
        gl.uniform4fv(program.uAmbientLight, uniforms.uAmbientLight);
        gl.uniform4fv(program.uAmbientMaterial, uniforms.uAmbientMaterial);
        gl.uniform4fv(program.uDiffuseLight, uniforms.uDiffuseLight);
        gl.uniform4fv(program.uDiffuseMaterial, uniforms.uDiffuseMaterial);
        gl.uniform4fv(program.uSpecularLight, uniforms.uSpecularLight);
        gl.uniform4fv(program.uSpecularMaterial, uniforms.uSpecularMaterial);
    }


    function rotateMatrices() {
        mat4.rotateX(uMVMatrix, uMVMatrix, rotateX);
        mat4.rotateY(uMVMatrix, uMVMatrix, rotateY);
        mat4.rotateZ(uMVMatrix, uMVMatrix, rotateZ);
        mat3.normalFromMat4(uNMatrix, uMVMatrix);
        mat3.transpose(uNMatrix, uNMatrix);
    }


    function positionGenerator() {
        var x = Math.floor(Math.random() * 60);
        var y = Math.floor(Math.random() * 60);
        var flagX = Math.floor(Math.random() * 10);
        var flagY = Math.floor(Math.random() * 10);
        if (flagX >= 5) x = -x;
        if (flagZ >= 5) z = -z;
        return [x, 0, z];
    }

    var colorset = {};

    function objectLabelGenerator() {
        var color = [Math.random(), Math.random(), Math.random(), 1.0];
        var key = color[0] + ":" + color[1] + ":" + color[2];
        if (key in colorset) return objectLabelGenerator();
        color[key] = true;
        return key;
    }

    function diffuseColorGenerator(index) {
        var c = (index % 30 / 60) + 0.2;
        return [c, c, c, 1];
    }

    function scalingFactorGenerator(base) {
        var f = Math.random() * 10 + base;
        return [f, f, f];
    }


    function setOffscreenUniform(value) {
        gl.uniform1i(program.uOffScreen, !!value);
    }

    function readPixels(framebuffer, x, y) {
        var pixel = new Uint8Array(4);
        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
        gl.readPixels(x, y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        return pixel;
    }

    function compare(pixel, color) {
        return (Math.abs(Math.round(color[0] * 255) - pixel[0]) <= 1) &&
                (Math.abs(Math.round(color[1] * 255) - pixel[1]) <= 1) &&
                (Math.abs(Math.round(color[2] * 255) - pixel[2]) <= 1);
    }


    function Picker(canvas, framebuffer, models) {
        this._canvas = canvas;
        this._canvas.addEventListener("click", this._onclick, false);
        this._framebuffer = framebuffer;
        this._models = models;
    }

    Picker.prototype = {
        _onclick: function (e) {
            var x = this.clientX - e.pageX;
            var y = this.clientY - e.pageY;
            var pixels = readPixels(this._framebuffer, x, y);
            this._models.forEach(function (model) {
                if (compare(pixels, model.diffuse)) {
                    // treffer
                }
            }, this);
        }
    };

    function bindTexture(texture, texCoords) {

        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.uniform1i(program.uSampler, 0);
        gl.enableVertexAttribArray(program.aTextureCoord);
        gl.bindBuffer(gl.ARRAY_BUFFER, texCoords);
        gl.vertexAttribPointer(program.aTextureCoord, 2, gl.FLOAT, false, 0,0);


    }

    function drawCube() {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, cubeBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useTexture) {
            gl.uniform1i(program.uTexture, true);
            bindTexture(cubeBuffers.t, cubeBuffers.tc);
        } else if (useColorArray) {
            bindColorBuffer(cubeBuffers.c);
        } else {
            if (cubeBuffers.sc) setVertexColor(cubeBuffers.sc);
            else setVertexColor([1.0, 0.5, 0.9, 1.0]);
        }
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, cubeBuffers.i);
        gl.drawElements(gl[drawingMode], cubeBuffers.i.numItems, gl.UNSIGNED_SHORT, 0);
        if (useTexture) {
            gl.uniform1i(program.uTexture, false);
            gl.bindTexture(gl.TEXTURE_2D, null);
            gl.disableVertexAttribArray(program.aTextureCoord);
        }
    }

    function drawTriangle() {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, triangleBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useColorArray) {
            gl.enableVertexAttribArray(program.aVertexColor);
            gl.bindBuffer(gl.ARRAY_BUFFER, triangleBuffers.c);
            gl.vertexAttribPointer(program.aVertexColor, 3, gl.FLOAT, false, 0, 0);
        } else {
            gl.disableVertexAttribArray(program.aVertexColor);
            gl.vertexAttrib3fv(program.aVertexColor, [0.312315, 0.56357, 0.23525, 1.0]);
        }
        gl.drawArrays(gl[drawingMode], 0, triangleBuffers.v.numItems);
    }

    function bindColorBuffer(colorBuffer) {
        gl.enableVertexAttribArray(program.aVertexColor);
        gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
        gl.vertexAttribPointer(program.aVertexColor, 3, gl.FLOAT, false, 0, 0);
    }

    function drawWall() {

        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, wallBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useColorArray) {
            bindColorBuffer(wallBuffers.c);
        } else {
            setVertexColor([0.312315, 0.56357, 0.23525, 1.0]);
        }
        gl.drawArrays(gl[drawingMode], 0, wallBuffers.v.numItems);

    }

    function setVertexColor(aColor) {
        gl.disableVertexAttribArray(program.aVertexColor);
        gl.vertexAttrib3fv(program.aVertexColor, aColor);
    }

    var mstack = [];
    function pushMatrix() {
        mstack.push(uniforms.uMVMatrix);
        mstack.push(uniforms.uPMatrix);
    }
    function popMatrix() {
        uPMatrix = uniforms.uPMatrix = mstack.pop();
        uMVMatrix = uniforms.uMVMatrix = mstack.pop();
    }
    function enablePosition(mesh) {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, mesh.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
    }
    function enableIndices(mesh) {
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mesh.i);
    }
    function drawGrid() {
        enablePosition(gridBuffers);
        enableIndices(gridBuffers);
        gl.drawElements(gl[drawingMode], gridBuffers.i.numItems, gl.UNSIGNED_SHORT, false, 0, 0);
    }
    function drawFloor() {
        pushMatrix();
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, floorBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useTexture) {
            bindTexture(floorBuffers.t, floorBuffers.tc);
            gl.uniform1i(program.uTexture, true);
        }
        else if (useColorArray) {
            bindColorBuffer(floorBuffers.c);
        } else {
            setVertexColor([0.0, 0.5, 0.9, 1.0]);
        }
        gl.drawArrays(gl[drawingMode], 0, floorBuffers.v.numItems);
        popMatrix();
        if (useTexture) {
            gl.uniform1i(program.uTexture, false);
        }
    }

    function drawCone() {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, coneBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useColorArray) {
            bindColorBuffer(coneBuffers.c);
        } else {
            setVertexColor([1.0, 0.5, 0.9, 1.0]);
        }

        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, coneBuffers.i);
        gl.drawElements(gl[drawingMode], coneBuffers.i.numItems, gl.UNSIGNED_SHORT, 0);
    }

    function drawSphere() {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, sphereBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        useColorArray = uC.checked;
        if (useColorArray) {
            bindColorBuffer(sphereBuffers.c);
        } else {
            setVertexColor([0.0, 0.5, 0.9, 1.0]);
        }
        //gl.drawElements(gl[drawingMode], sphereBuffers.i.numItems, gl.UNSIGNED_SHORT, 0, 0);
        gl.drawArrays(gl[drawingMode], 0, sphereBuffers.v.numItems);
    }

    function drawTrapezoid() {
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.bindBuffer(gl.ARRAY_BUFFER, trapezoidBuffers.v);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, trapezoidBuffers.i);
        useColorArray = uC.checked;
        if (useColorArray) {
            bindColorBuffer(trapezoidBuffers.c);
        } else {
            setVertexColor([0.0, 0.5, 0.9, 1.0]);
        }
        gl.drawElements(gl[drawingMode], trapezoidBuffers.i.numItems, gl.UNSIGNED_SHORT, 0, 0);
    }

    function drawTeapot() {
    }

    function makeTeapot() {
    }

    function enableBlending() {
        gl.enable(gl.BLEND);
        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);
    }

    function disableBlending() {
        gl.disable(gl.BLEND);
    }


    var setDepthTest = document.getElementById("setDepthTest");
    setDepthTest.addEventListener("change", function (e) {
        if (this.checked) enableDepthTest();
        else disableDepthTest();
    });

    setDepthTest.checked = true;
    enableDepthTest();

    function enableDepthTest() {
        gl.enable(gl.DEPTH_TEST);
    }

    function disableDepthTest() {
        gl.disable(gl.DEPTH_TEST);
    }


    var startTime, currentTime, frameTime, ri;

    function startAnim(rate) {
        startTime = Date.now();
        frameTime = rate || 1000 / 60;
        ri = setInterval(render, frameTime);
    }

    function stopAnim() {
        startTime = null;
        clearInterval(ri);
    }

    function render() {
        if (startTime == null) return;
        currentTime = Date.now();
        if (currentTime - startTime > frameTime) {
            requestAnimationFrame(draw);
            startTime = Date.now();
        }
    }

    // FPS Cpunter
    var fpsLabel = document.getElementById("fps");

    var fpsCount = 0;
    var fpsLastTime
    var fpsCurrentTime;
    fpsLastTime = Date.now();


    function showMatrices() {
        showMatrix("MVMatrix", uniforms.uMVMatrix);
        showMatrix("PMatrix", uniforms.uPMatrix);
        showMatrix3("NMatrix", uniforms.uNMatrix);
        showMatrix("uCamera", uniforms.uCamera);
    }

    function draw() {
        "use strict";
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        fpsCurrentTime = Date.now();


        rotateMatrices();

        setUniforms();

        switch (selectedMesh) {
            case "Cube":
                drawCube();
                break;
            case "Triangle":
                drawTriangle();
                break;
            case "Grid":
                drawGrid();
                break;
            case "Floor":
                drawFloor();
                break;
            case "Plane+Wall":
                drawFloor();
                drawWall();
                break;
            case "Cone":
                drawCone();
                break;
            case "Trapezoid":
                drawTrapezoid();
                break;
            case "Sphere":
                drawSphere();
                break;
            case "Teapot":
                drawTeapot();
                break;
        }

        if (fpsCurrentTime - fpsLastTime >= 1000) {
            fpsLastTime = fpsCurrentTime;
            fpsLabel.innerHTML = fpsCount;
            fpsCount = 0;
            showMatrices();
        }
        fpsCount += 1;

    }

    requestAnimationFrame(draw, 0);


    // ---
    var keyboard = {
        onkeypress: function (keyCode) {
            switch (keyCode) {
                case 71:
                case 72:
                case 73:
                case 74:
                default:
            }
        },
        onkeydown: function (keyCode) {

        },
        onkeyup: function (keyCode) {

        }
    };
    // ----
    function handleKeyPress(e) {
        keyboard.onkeypress(e.keyCode);
    }

    window.addEventListener("keypress", handleKeyPress, false);
    // --

    (function () {
        var showCanvas = document.getElementById("showCanvas");
        showCanvas.addEventListener("click", function () {
            canvasView.hidden = !canvasView.hidden;
            if (!canvasView.hidden) {
                vertexShaderView.hidden = true;
                fragmentShaderView.hidden = true;
                javaScriptView.hidden = true;
            }

        });
        var showVertexShader = document.getElementById("showVertexShader");
        showVertexShader.addEventListener("click", function () {
            vertexShaderView.hidden = !vertexShaderView.hidden;
            if (!vertexShaderView.hidden) {
                vertexShaderView.innerHTML = "<pre>" + document.getElementById("vs").textContent + "</pre>";
                canvasView.hidden = true;
                fragmentShaderView.hidden = true;
                javaScriptView.hidden = true;
            }
        });
        var showFragmentShader = document.getElementById("showFragmentShader");
        showFragmentShader.addEventListener("click", function () {
            fragmentShaderView.hidden = !fragmentShaderView.hidden;
            if (!fragmentShaderView.hidden) {
                fragmentShaderView.innerHTML = "<pre>" + document.getElementById("fs").textContent + "</pre>";
                canvasView.hidden = true;
                vertexShaderView.hidden = true;
                javaScriptView.hidden = true;
            }

        });
        var showJavaScript = document.getElementById("showJavaScript");
        showJavaScript.addEventListener("click", function () {
            javaScriptView.hidden = !fragmentShaderView.hidden;
            if (!javaScriptView.hidden) {
                javaScriptView.innerHTML = "<pre>" + document.getElementById("webglapp").textContent + "</pre>";
                canvasView.hidden = true;
                vertexShaderView.hidden = true;
                fragmentShaderView.hidden = true;
            }

        });
        var canvasView = document.getElementById("canvasView");
        var vertexShaderView = document.getElementById("vertexShaderView");
        var fragmentShaderView = document.getElementById("fragmentShaderView");
        var javaScriptView = document.getElementById("javaScriptView");
    }());


    function showMatrix(id, mat) {

        var html = "<table class=matrix>" +
                "<tr><td colspan='4'>" + id + "</td></tr>" +
                "<tr><th>x</th><th>y</th><th>z</th><th>w</th></tr>" +
                "<tr><td>" + mat[0] + "</td><td>" + mat[4] + "</td><td>" + mat[8] + "</td><td>" + mat[12] + "</td></tr>" +
                "<tr><td>" + mat[1] + "</td><td>" + mat[5] + "</td><td>" + mat[9] + "</td><td>" + mat[13] + "</td></tr>" +
                "<tr><td>" + mat[2] + "</td><td>" + mat[6] + "</td><td>" + mat[10] + "</td><td>" + mat[14] + "</td></tr>" +
                "<tr><td>" + mat[3] + "</td><td>" + mat[7] + "</td><td>" + mat[11] + "</td><td>" + mat[15] + "</td></tr>" +
                "</table>";
        document.getElementById(id).innerHTML = html;
    }

    function showMatrix3(id, mat) {

        var html = "<table class=matrix>" +
                "<tr><td colspan='3'>" + id + "</td></tr>" +
                "<tr><th>x</th><th>y</th><th>z</th></tr>" +
                "<tr><td>" + mat[0] + "</td><td>" + mat[3] + "</td><td>" + mat[6] + "</td></tr>" +
                "<tr><td>" + mat[1] + "</td><td>" + mat[4] + "</td><td>" + mat[7] + "</td></tr>" +
                "<tr><td>" + mat[2] + "</td><td>" + mat[5] + "</td><td>" + mat[8] + "</td></tr>" +
                "</table>";
        document.getElementById(id).innerHTML = html;
    }
}
</script>

</body>
